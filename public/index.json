[{"content":" Backup your data regularly. The EGM-4\u0026rsquo;s internal memory is limited to 1,500 records across up to 99 plots. Failing to dump data regularly will result in data loss when this buffer fills. When memory is full, the oldest records are overwritten. You are responsible for your data. Significant care has been taken to ensure data safety. However, by using the open-egm4 software, you accept the risk of data loss. Open-egm4 can not send commands to the EGM-4 itself, and therefore cannot damage it internally. Don\u0026rsquo;t get water in the gas lines. If you do, it might enter the IRGA itself and damage it. It\u0026rsquo;s like $15,000 to replace. Introduction The PP Systems EGM-4 (EGM) is a portable infrared gas analyzer (IRGA) designed for measuring soil CO₂ efflux. The device connects to various chamber types and soil probes, and stores measurements in its internal memory.\nThe open-egm4 software is a terminal interface designed to make data collection from the EGM reliable and easy. Unlike the legacy (read: outdated, buggy and frustrating) Windows software from PP Systems, this runs on macOS, Linux, and modern Windows systems.\nThis guide covers operation of the EGM itself, the SRC-1 chamber, how to use them alongside the open-egm4 software, common field scenarios and troubleshooting everything involved.\nInstalling open-egm4 What is open-egm4?\nA terminal-based (text interface) application that communicates with the EGM Provides real-time CO₂ visualization, data logging, and exporting of said data to a csv Works on any modern operating system Can run over SSH for remote field work (if anyone thinks of a genuine use case for this please tell me) What is a Terminal? A terminal (also called \u0026ldquo;command line\u0026rdquo; or \u0026ldquo;shell\u0026rdquo;) is a text-based interface for your computer. Think of it as typing commands directly to your computer instead of clicking on icons. Using a computer through the terminal (or, pedantically, it\u0026rsquo;s terminal) typically gives you much greater control and choice over its operation. In this case, open-egm4 was developed as a TUI (terminal user interface: an app that runs inside of the terminal) because it allows the app to be significantly smaller, more portable, and more lightweight to run on underpowered computers.\nFor more information on my debatable decision to develop the app for the terminal, see the appendix.\nSystem Requirements:\nmacOS 10.14+, Windows 10+, or any modern Linux Python 3.8+ (the installer handles this automatically) USB serial port or USB-to-serial adapter Note If you are buying a USB-serial adapter, make sure to get one that uses a FTDI chipset. Cheap adapters often use \u0026ldquo;Prolific\u0026rdquo; chips which have notoriously bad drivers. FTDI chips are easier and require zero thought to use. Internet connection (for installation only) One-Line Installation This is the easiest method. A script handles everything: installing Python dependencies, downloading the software, and setting up shortcuts so you can run open-egm4 from anywhere.\nStep 1: Open Your Terminal macOS:\nPress Cmd + Space to open Spotlight search. Type \u0026ldquo;Terminal\u0026rdquo; Press Enter A window with white or black background appears—this is your terminal. Windows:\nClick the Start Menu (Windows logo) Type \u0026ldquo;PowerShell\u0026rdquo; Press Enter A window appears with text—this is your terminal (command prompt is also a terminal, but it is exclusive to Windows; it has also been around since the 80s: PowerShell is Microsoft\u0026rsquo;s attempt at an updated terminal for Windows.) Linux: You already know how to open a terminal.\nStep 2: Copy and Paste the Installation Command With great power\u0026hellip; Entering commands into a terminal gives you much more control over your computer than most users are used to. While this power is beneficial for knowledgeable users, it also makes it easy to make potentially irreversible mistakes. \u0026hellip;comes great responsibility. You should never copy and paste commands into your terminal from sources you do not trust. A malicious command could delete files, install malware, or send your data to an attacker. While I wrote this script, you are ultimately trusting me not to do something harmful. You can (and really should) view the install script source before running it. In your terminal window, copy and paste this line as written:\nmacOS / Linux:\ncurl -sSL https://raw.githubusercontent.com/mmorgans/open-egm4/main/install.sh | bash Windows (PowerShell):\nirm https://raw.githubusercontent.com/mmorgans/open-egm4/main/install.ps1 | iex How to Paste in Terminal:\nmacOS: Press Cmd + V (normal paste works) Windows (PowerShell): Right-click to paste, OR Ctrl + Shift + V Linux: Ctrl + Shift + V (not Ctrl + V!) Press Enter to run the command.\nRunning the installation script when open-egm4 is already installed allows you to update, repair, or uninstall the software. Step 3: What You\u0026rsquo;ll See During Installation After pressing Enter, text will start scrolling down the screen. You\u0026rsquo;ll see messages like:\n[INFO] Checking prerequisites... [INFO] Installing fresh to /Users/hello/.open-egm4... [INFO] Creating virtual environment... [INFO] Fetching latest version and installing dependencies... The installation takes 1-3 minutes depending on your internet speed. When you see \u0026ldquo;Installation Complete\u0026rdquo;, it\u0026rsquo;s done.\nTroubleshooting:\nOn Linux, you might need to add your user to the dialout group to access the serial port. You can do this with the command sudo usermod -a -G dialout $USER If you see \u0026ldquo;curl: command not found\u0026rdquo; on Windows, try using PowerShell instead of cmd If you see \u0026ldquo;Python not found\u0026rdquo;, the installer will attempt to install it automatically If installation fails, try the manual installation below. If it still doesn\u0026rsquo;t work, shoot me an email and I\u0026rsquo;ll try to help. Pip Installation If you\u0026rsquo;re comfortable with Python environments:\n# Install via pipx (recommended for isolation) pipx install git+https://github.com/mmorgans/open-egm4 # OR install in your active virtual environment pip install git+https://github.com/mmorgans/open-egm4 If you want to edit the code of open-egm4, there are more instructions on the repository page.\nInitial Connection to the EGM-4 Once software is installed, connect the EGM to a computer:\nPhysical Connection: Connect the serial cable to the EGM\u0026rsquo;s RS232 port Connect the USB-to-serial adapter to your computer Power on the EGM with the switch on the back When the EGM-4 boots, pay attention to the startup screen values. For example:\nC 2000 5V=2000\nProbetype 8 R248\nThis is useful because it tells you how that specific instrument is calibrated. In this example, C 2000 indicates the analyzer is calibrated to a 2000 ppm range.\nLaunch the Software: On your computer, in the terminal, run\nopen-egm4 Select Serial Port: The software will list available serial ports (e.g., /dev/tty.usbserial, COM3) It will also attempt to guess at which one the EGM is connected to and automatically connect to it If it doesn\u0026rsquo;t, select the port manually using the arrow keys, and hit Enter to confirm your choice. If you don\u0026rsquo;t see your port listed, check the cable connection and hit r on your keyboard to refresh the list of ports. On macOS, look for ports containing \u0026ldquo;usbserial\u0026rdquo; or \u0026ldquo;FTDI\u0026rdquo; On Windows, look for \u0026ldquo;COM\u0026rdquo; ports (COM3, COM4, etc.) Windows lacks default braille support, so open-egm4 automatically uses lower-detail symbols if running on Windows. If you install a compatible font, launch open-egm4 with the --force-unicode flag to enable high-detail braille graphs. You can see which platform and graphics mode open-egm4 is using on the splash screen. Verify Connection:\nThe EGM screams out data over the serial connection, but it\u0026rsquo;s incapable of receiving any data back. Therefore, you\u0026rsquo;ll have no way of knowing if you\u0026rsquo;re actually connected to the EGM unless you dump some data to your computer. Details on how to collect data are in the workflow section, but for now you can verify that the software was installed correctly by dumping existing data from the EGM to your computer, assuming that there is pre-existing data on the EGM. To send data from the EGM to a computer, press 4DMP on the EGM, then 2 DATA DUMP, then press any key to begin the transfer. If you see the data streaming in on your computer, celebrate. If you don\u0026rsquo;t, then check out the troubleshooting section. Press q to quit (or Ctl + c, which should quit most running terminal commands) when you\u0026rsquo;re done exploring.\nEGM-4 hardware Physical Interface \u0026amp; Controls The EGM-4 is a portable, battery-powered CO₂ analyzer. Key components:\nFront Panel:\nLCD Display: 2×16 character display 1-9 keypad, along with Y/R key (used for accepting and recording) and N key (used for denying and going back) 8/X allows you to toggle between display screens while taking a measurement 0/Z allows you to manually zero the EGM-4 during a measurement Top:\nGas In Port: Connect sample inlet tubing (1/8\u0026quot; ID) Gas Out Port: Exhaust port (1/8\u0026quot; ID) AND (counter-intuitively) should be used as an injection port for static syringe samples I/O Connectors: Two 15-pin D-sub connectors for sensors (notably the SRC-1) RS232 Port: 9-pin connector for data transfer to a computer Back:\nPower Switch: Self explanatory 12V DC Charge Socket: For charging the internal battery and running the EGM off of mains power Fuse: 1A fuse Soda Lime Cap: Access to the CO₂ scrubbing column for replacing it. Power \u0026amp; Battery The EGM-4 uses a 12V 2.0Ah sealed lead-acid battery. It should last around 4 hours of use at 20ºC. If the temperature is below 5ºC, the battery life drops 30-40%.\nAt low temperatures, you should hold the EGM inside your jacket, maintaining skin-to-skin contact. This will increase the battery life by a few minutes, and will psychologically bond you with the device. Charging: The manual purports that the battery takes 12 hours to charge fully. I think that\u0026rsquo;s a made up number, and in my testing it\u0026rsquo;s ready for action after around 2 hours. Your mileage may vary.\nIf you are planning on storing the EGM long term, charge the battery beforehand to avoid damaging it.\nThe EGM\u0026rsquo;s internal clock loses time when the battery dies. After replacing or fully recharging the battery, make sure the date/time settings are correct before taking measurements. This is critical for ensuring that your data is properly timestamped. Replacement: To replace the battery, see the troubleshooting section.\nSRC-1 Soil Respiration Chamber The SRC-1 is a soil respiration chamber that allows you to measure the rate of soil respiration by monitoring the rate of increase of CO₂ concentration within a closed system: the chamber itself. See the SRC-1 Workflow section.\nopen-egm4 software This section covers how to use the open-egm4 software, assuming you\u0026rsquo;ve already installed it.\nLaunch the software by running open-egm4 in your terminal.\nConnection screen When you launch the software, you\u0026rsquo;ll see the connection screen, with a list of ports.\nOpen-egm4 will attempt to detect which port the EGM-4 is connected to and automatically connect to it after 5 seconds. Use the arrow keys to cancel this countdown and select a port manually.\nTo select a port manually, use the arrow keys to navigate the list of ports and press Enter to confirm your selection. If you don\u0026rsquo;t see your port listed, check the cable connection and hit r on your keyboard to refresh the list of ports. If you accidentally select the wrong port, hit q to quit and try again.\nOn macOS and Linux, the EGM-4 will likely appear as a port containing \u0026ldquo;usbserial\u0026rdquo; or \u0026ldquo;FTDI\u0026rdquo; On Windows, the EGM-4 will likely appear as a \u0026ldquo;COM\u0026rdquo; port (COM3, COM4, etc.) Open-egm4 automatically saves data to its internal database. This allows you to restore from a previous session without having to re-dump data from the EGM. To do this, press s while on the connection screen. You\u0026rsquo;ll see a list of saved sessions, and you can use the arrow keys to select one and press Enter to restore it. You do not need to have the EGM connected to the computer to restore a session. While the EGM is not connected, \u0026ldquo;Offline\u0026rdquo; will be displayed in the status panel.\nMain interface This is the main interface, where you\u0026rsquo;ll spend most of your time. It consists of:\nLeft Panel - Graph: This panel displays incoming data from the EGM, whether it be from a live measurement or previously generated data. The axes will automatically rescale to fit the data. The units will also change depending on how you are viewing the data, so be sure to check the legend to understand what you\u0026rsquo;re looking at.\nDirectly below the graph are the available channels and graph controls. The available channels will change depending on what probe was connected when the the data was recorded. Press the number key associated with each channel to view that channel in the graph.\nAbove the graph, you\u0026rsquo;ll see information about what the graph is currently displaying, including the currently selected channel, the units of the y-axis, and the plot number.\nPress the \u0026lt; or \u0026gt; keys to cycle through different plots. This is useful to view measurements from a specific location (i.e. a plot in the field), and to filter out data you aren\u0026rsquo;t interested in viewing.\nPress i to toggle inspect mode on the graph. In this mode, a yellow x appears on the graph, and you can use the left and right arrow keys to move the cursor along the x-axis. The y-values for the currently selected channel at the cursor\u0026rsquo;s position are displayed above the graph. Press i again to exit inspect mode.\nRight Panels - Status and Log: These panels display the current status of the EGM and the log of recent events. The status panel shows the current CO₂ concentration, along with derived statistics from that value. The log panel shows EGM system messages and app events.\nFooter: The footer displays a list of all commands, along with their keyboard shortcuts.\nKeyboard Commands Key Action Description q Quit Saves and exits as quickly as possible e Export Opens the export screen to save data as CSV c Clear Clears all chart data (with confirmation) p Pause Pauses/resumes the data stream n Note Add a timestamped note to the log b Big Mode Large CO₂ display for visibility outdoors d Theme Toggle between dark and light themes i Inspect Toggleable mode to examine individual points ? Help Information about the app 1 - 9 Switch between data channels , / . Cycle between different plots \u0026lt; / \u0026gt; Same as above: plot selection ← / → Move cursor (when in Inspect mode) Exporting data Press e to open the export screen. This allows you to filter and export your data.\nAt the top of the export screen, you\u0026rsquo;ll see the number of data currently selected to export. Initially, this will be all of the data currently in the app.\nFiltering data To export only a subset of that data, use the p and d keys to select only certain plots and dates, respectively.\nTo select specific plots to export, press p to open the plot selection screen. Use the arrow keys to navigate the list of plots and press Space to select or deselect a plot. Press p again to confirm and return to the export screen.\nTo select specific dates to export, press d to open the date selection screen. Use the arrow keys to navigate the list of dates and press Space to select or deselect a date. Press d again to confirm and return to the export screen.\nYou should see the number of data points to export update as you make your selections. Once you\u0026rsquo;ve selected the data you want to export, press e to export the data.\nOutput .csv files should be saved to your Downloads directory. If this fails, the file will be saved in the same directory as open-egm4 was run in (likely your home directory).\nPausing (p) Press p to pause the data stream. While paused, the chart will stop updating with data, but you can still interact with the app. This is useful if you need to examine the chart without it updating with new data. Press p again to resume the data stream.\nAdding notes (n) Press n to add a timestamped note to the log. This will open a prompt where you can type a note. Press Enter to save the note, or Esc to cancel.\nStatic sampling mode (m, n, x) Static sampling mode guides syringe-injection sampling directly from the monitor screen.\nPress m to toggle static sampling mode on or off. When enabled, the stats panel shows STATIC SAMPLING and the current step prompt. Press n to advance the guided cycle: STEP 1: INJECT SAMPLE (N) STEP 2: WAIT TO SETTLE, CAPTURE (N) STEP 3: INJECT AMBIENT AIR (N) During Step 2, pressing n opens a label prompt for the sample. You can leave it blank to auto-name the sample. open-egm4 records both the settled concentration and the post-injection peak concentration for each captured sample. Press x at any time to reset the cycle back to Step 1. Exported CSV files include static sample rows (type=SAMPLE) with sample_id, sample_label, sample_ppm, and sample_peak_ppm. Clearing data (c) Press c to clear all data from the current session. You will be asked to confirm before the data is cleared.\nThis does not clear data from the EGM\u0026rsquo;s internal memory, only data that you have already dumped to the app. To clear data from the EGM\u0026rsquo;s internal memory, see the initialize section. Quitting (q) Press q to quit the app. All data from your session are automatically saved (distinct from .csv files you may have exported), and you can restore it the next time you open the app by pressing s while on the connection screen.\nOpen-egm4 automatically saves data to an internal database. To restore from a previous session, see the connection screen section. Workflows Workflow 1: Soil Respiration with SRC-1 Chamber This is the most common application: measuring CO₂ efflux from soil using the SRC-1 closed-chamber method.\nEquipment Needed:\nEGM-4 with fully charged battery SRC-1 soil respiration chamber Soil collars* Optional: Laptop running open-egm4 for monitoring Soil Collars: Install the soil collars well before you plan to measure (this should be planned prior to doing field work). A well-placed collar should be installed 3-5cm deep into the soil surface. Remove any aboveground vegetation inside the collar.\nThe above instructions depend almost entirely on your situation. You might consider installing the soil collar weeks or months ahead of time. The depth of the collar needed to ensure a good measurement will depend on the soil type and the goals of your experiment. Field Procedure:\nConnect SRC-1 to EGM-4:\nConnect the I/O cable of the SRC-1 to the EGM-4 Connect the gas tube labeled \u0026ldquo;R\u0026rdquo; to the gas in port of the EGM-4 Connect the unlabeled gas tube to the gas out port of the EGM-4 Startup \u0026amp; Warmup (10-15 minutes):\nPower on the EGM Wait for warm-up message to complete: the EGM must reach an internal temperature of 55°C to be able to take readings Enter Measurement Mode:\nPress 1 (REC) from the main menu The EGM will display measurement settings Default: DT=120 seconds (measurement duration), DC=50 ppm (max CO₂ change) Press N to change settings, or Y to confirm and continue Select Fitting Method:\nAfter confirming settings, the EGM will display 1LINEAR 2QUAD? Press 1 for Linear Fit: Best for short measurements (under 2 minutes) or low-flux soils Press 2 for Quadratic Fit: Better for longer measurements or high-flux soils where CO₂ buildup may cause the flux rate to level off Linear fitting assumes a constant flux rate throughout the measurement. Quadratic fitting accounts for the natural slowdown that occurs as CO₂ builds up in the chamber. If you\u0026rsquo;re unsure, quadratic is generally safer for measurements over 2 minutes. See Appendix B for the math behind each method. You should think carefully about the DT value that you set for a given measurement, especially if you selected a linear fit. If the DT value is too large the rate at which CO₂ accumulates in the chamber will decline, and your estimate of the efflux rate will be less accurate. Set Plot Number: The EGM will display \u0026ldquo;PLOT NO = X\u0026rdquo; Press Y to keep the current plot number Or enter a new plot number (e.g., \u0026ldquo;01\u0026rdquo; for plot 1) and press Y If you use a plot number that has already been used, the EGM will overwrite the previous measurement, causing irreversible data loss. Chamber Flush:\nThis happens automatically. The EGM will display \u0026ldquo;CHAMBER FLUSHING - HOLD IN AIR\u0026rdquo; Hold the chamber in the air for ~15 seconds at arms length Deployment:\nThe EGM will display \u0026ldquo;PLACE ON SOIL - PRESS Y TO START\u0026rdquo; Place the chamber on the soil collar, using Blu Tack on the rim of the chamber to ensure a good seal Press Y to start measurement Equilibration:\nThe EGM will display \u0026ldquo;EQUILIBRATION - PLEASE WAIT\u0026rdquo; The system will equilibrate for ~5 seconds Then measurement begins automatically Measurement:\nThe EGM will display: C 420 H14.7 T22 A02.11 Q0000 110 C: Current CO₂ (ppm) H: Humidity (mb, if sensor connected) T: Soil temperature (°C, if sensor connected) A: Calculated flux rate (g CO₂ m⁻² hr⁻¹) Q: PAR light level (if sensor connected) 110: Elapsed time (seconds) — shows \u0026ldquo;END\u0026rdquo; when complete After a measurement, you will be prompted to save the measurement with \u0026ldquo;RECORD Y/N\u0026rdquo; Press Y to save the measurement Press N to discard and retry Remove Chamber \u0026amp; Continue:\nThe EGM will display \u0026ldquo;REMOVE FROM SOIL THEN PRESS Y KEY\u0026rdquo; Lift chamber from soil collar Press Y to prepare for the next measurement The plot number will not auto-increment. You must manually enter the plot number for each measurement. Note that the EGM will happily overwrite the previous measurement if you don\u0026rsquo;t change the plot number between measurements! Data Viewing \u0026amp; Storage: Though not necessary, you can have your computer connected to the EGM while you are taking soil repisration measurements. This allows you to view the incoming the data in real time, using open-egm4, and see it graphed. This can be helpful for understanding how long it takes your soil system to produce enough CO₂ to lessen the diffusion gradient driving respiration fluxes into the chamber.\nRegardless, because you designated a plot number before you started the measurement, the EGM will store the data in its internal memory. The EGM stores up to 1,500 records, and will start overwriting old records if full. See instructions on how to export data from the EGM.\nTo transfer stored records from field plots on the EGM-4 to your computer, do the following:\nConnect the EGM-4 to your computer using a serial cable and USB adapter Power on the EGM-4 and open the open-egm4 app on your computer by typing open-egm4 in the terminal Press 4DMP from the Main Menu on the EGM-4, then Press 2 DATA DUMP Once the open-egm4 app is ready, press any key on the EGM-4 to start the transfer View your data on the graph, and use the \u0026lt; and \u0026gt; keys to view a specific plot Press e to open the export menu. Use the p and d keys to select the plot(s) and/or date(s) you want to export, then press e to export The .csv will be saved to your Downloads directory Data Record Structure:\nEach record contains (in CSV format):\nM/R flag (M=real-time, R=stored record) Plot number (0-9999) Record number (1-9999) Date (day, month) Time (hour, minute) CO₂ (ppm) H₂O vapor (mb, if sensor present) RH/Temp sensor data Sensor inputs A-E (mV values) Atmospheric pressure (mb) Probe type (0-11) Workflow 2: Static Sampling via Syringe Injection Static sampling is used when you want to measure CO₂ concentration of a discrete air sample without continuous flow. Common applications: measuring gas concentrations from sealed containers, soil headspace, or captured gas samples.\nInstead of pumping air continuously through the EGM-4, you inject a small volume of sample directly into the measurement cell using a syringe. The internal pump is turned off to avoid diluting your sample.\nEquipment Needed:\nEGM-4 with battery Luer-lock syringe (5-10 ml) Sample vial or other vessel from which you will take a syringe sample A female luer-lock adapter to connect the syringe to the EGM A computer with open-egm4 installed Ensure that water does not enter the EGM when injecting a sample. If water enters the EGM, it will damage the IRGA. Setup Procedure:\nConnect to Computer:\nConnect the EGM to your computer using a serial cable and USB adapter Open the open-egm4 app on your computer by typing open-egm4 in the terminal Enable Static Sampling Mode on the EGM:\nFrom Main Menu, press 2 (SET) Press 3 (PMP) to access pump control Current display shows \u0026ldquo;SAMPLE PUMP ON / Y/OK N/CHANGE\u0026rdquo; Press N to change Display now shows \u0026ldquo;STATIC SAMPLING / Y/OK N/CHANGE\u0026rdquo; Press Y to confirm Prepare for Injection on the EGM:\nPress 1 (REC) to enter measurement mode The EGM will show the current CO₂ concentration Observe the baseline CO₂ concentration on your computer over time Enable guided static workflow in open-egm4:\nPress m on the monitor screen to enable Static Sampling mode The stats panel should show STATIC SAMPLING and STEP 1: INJECT SAMPLE (N) Press x at any time to reset the cycle back to Step 1 Inject sample and acknowledge Step 1:\nDraw sample into syringe (at least 5 ml is recommended for a stable reading) Locate the gas out port on top of EGM and ensure that the female luer-lock adapter is securely connected Attach the luer-lock syringe to the gas out port and inject sample Press n immediately after injection to acknowledge Step 1 and start peak tracking Capture settled value (Step 2):\nWatch the concentration spike and then settle Press n when the value has stabilized to capture the sample Enter an optional sample label when prompted (leave blank for auto labels like \u0026ldquo;Sample 1\u0026rdquo;) open-egm4 saves both: the settled concentration (sample_ppm) the highest concentration seen after injection (sample_peak_ppm) Flush and reset (Step 3):\nInject ambient air into the EGM to flush the cell between samples Press n to confirm flush and automatically return to Step 1 for the next sample Data downloading and sample metadata:\nStatic sample events are stored only in the open-egm4 session on your computer Export with e (open export screen), then e again to write CSV CSV exports now include type=SAMPLE rows with: sample_id sample_label sample_ppm (settled value) sample_peak_ppm (post-injection peak) The CSV will still include normal second-by-second measurement rows for the full session Auto-Zero Warnings in Static Mode: The EGM-4 will still perform automatic zeros even with pump off. You\u0026rsquo;ll see warnings:\n\u0026ldquo;AUTO ZERO IN 2 MINUTES\u0026rdquo; \u0026ldquo;AUTO ZERO IN 1 MINUTE\u0026rdquo; When zero begins, the pump turns on for ~15 seconds, then turns off again. This ensures an accurate baseline by passing air scrubbed of CO₂ by the soda lime to the IRGA, and setting its CO₂ concentration to 0 ppm.\nDon\u0026rsquo;t forget to re-enable the pump after you have run all of your samples. Troubleshooting \u0026amp; Maintenance Only open the unit if you feel comfortable with electronics. Static discharge can damage sensitive components. Ground yourself before poking around. Replacing the Soda Lime CO₂ Scrubber The EGM needs to know what zero CO₂ looks like to make accurate measurements, and uses the soda lime to figure that out. Gradually, the granules in the soda lime column become saturated with CO₂ and can no longer absorb it, becoming pale in color as they do so. Replace when around 2/3 of the column have changed color.\nTo do this, unscrew the black cap on the back panel, pour out the old granules, and fill the column with fresh soda lime, leaving about an inch of space at the top. Replace the foam filter and cap.\nWash your hands after handling soda lime. It\u0026rsquo;s caustic. Replacing the Internal Battery The internal battery will need to be replaced after a few years of use. If you are unable to get more than 2 hours out of a single charge, the internal battery needs to be replaced.\nRemove the fuse On the back cover, slightly twist to remove the 1A fuse, and set it aside Remove the main cover Flip the EGM on it\u0026rsquo;s back Remove the 4 screws with a #1 Phillips screwdriver Carefully lift the EGM out of the cover by lifting the front and rear top edges Remove the back cover On the back cover, remove the two screws on the left and right edge with a #1 Phillips screwdriver Carefully lift the back cover away from the EGM by lowering the top of the cover, and leaning it away from the EGM You\u0026rsquo;ll need to tilt the rear cover until it\u0026rsquo;s perpendicular to the EGM to remove it Remove the front cover Using a 5.0mm socket, remove the two nuts on the left and right edges of the front cover Carefully lean the front cover away from the EGM, being sure to not stress the ribbons connecting it to the motherboard The only reason to remove the front cover is to assist in removing the old internal battery, by pushing on it through the hole in the battery enclosure Remove the internal battery Disconnect the battery from the two leads by lightly pulling them away from the battery Push on the battery from the hole in the enclosure, through the front panel, and out of the case Install the new battery Push the new battery into the enclosure, ensuring its seated properly Connect the battery to the two leads by lightly pushing onto the contacts Reassemble the front cover Carefully lean the front cover back into place, being sure to not stress the ribbons connecting it to the motherboard Using a 5.0mm socket, replace the two nuts on the left and right edges of the front cover Reassemble the back cover Carefully slide the back cover back into place, being sure to not stress the ribbons connecting it to the motherboard On the back cover, replace the two screws on the left and right edge with a #1 Phillips screwdriver Reassemble the main cover Holding the EGM in the air upside down, position the main cover underneath it, and carefully lower it into place Replace the 4 screws with a #1 Phillips screwdriver Reassemble the fuse On the back cover, slightly push and twist to replace the 1A fuse Replacing internal tubing Over time, the internal gas tubing will become aged and leak. You\u0026rsquo;ll need to replace it with 1/8\u0026quot; tubing, being careful not to create kinks or bends in the tubing. If you need 90 degree bends, some are available at McMaster-Carr (item number 5463K42).\nEGM-4 error codes The EGM-4 displays numbered error codes when problems occur:\nError 01: Zero Too Low\nCause: Soda lime exhausted, absorber column not seated, or valve failure Solution: Replace the soda lime. Ensure the soda lime cap is tight. Error 02: CO₂ \u0026lt; 250 ppm\nCause: Either genuine low CO₂ or same as Error 01 Solution: If you\u0026rsquo;re measuring ambient air (\u0026gt;420 ppm), this indicates same problems as Error 01 Error 03: Analyzer Temperature \u0026lt; 50°C\nCause: Instrument too cold or thermostat failure Solution: Allow longer warm-up time, or move somewhere warmer. Error 04: Analyzer Temperature \u0026gt; 60°C\nCause: Instrument overheating or thermostat failure Solution: Turn off, allow to cool. Check for ventilation blockage. Error 05: RH \u0026gt; 90%\nCause: High humidity or water in sample line Solution: In humid conditions, this may be normal. Error 06: Battery Voltage Low\nCause: Battery voltage \u0026lt; 10.5V Solution: Recharge the battery. If problem persists, replace the battery. Software Connection Issues \u0026ldquo;command not found\u0026rdquo;: Installation didn\u0026rsquo;t complete. Try re-installing. \u0026ldquo;No module named \u0026lsquo;serial\u0026rsquo;\u0026rdquo;: Missing dependency—reinstall with pip install pyserial Can\u0026rsquo;t connect to EGM-4:\nCheck the cables and make sure they\u0026rsquo;re securely connected Check EGM-4 is powered on Verify you selected the correct serial port Try a different serial port if multiple are available On Linux: check permissions (ls -l /dev/ttyUSB0 should show you have read access) Technical Appendix A: Serial Protocol Specification The EGM-4 communicates over RS-232 serial at 9600 baud, 8 data bits, no parity, 1 stop bit, and no flow control. This is a standard configuration supported by virtually all serial terminal software.\nEach data record is exactly 61 characters long (1 letter followed by 60 digits), with no spaces or delimiters, terminated by a carriage return and line feed (\\r\\n). The manual refers to \u0026ldquo;60 digits\u0026rdquo; which excludes the initial M/R mode character. During live measurements, the EGM transmits one record per second. When dumping stored data, all records are sent consecutively.\nHere\u0026rsquo;s an example raw record:\nR000002180313170042900000000000000000000000000400000000096508\nThe table below shows how to interpret parsed records. Both real-time measurements (M) and stored records (R) use the same format:\nM/R Plot No. Rec No Day Mo Hr Min CO₂ Ref H₂O Ref RHT A B C D E F G H AP PT M 1 1 28 1 13 19 968 0 000.0 0000 0000 0000 0000 0000 0000 00 00 991 0 R 1 2 28 1 13 21 930 0 000.0 0000 0000 0000 0000 0000 0000 00 00 991 0 The fixed columns are:\nColumn Description M/R M = real-time measurement, R = record retrieved from memory Plot No Plot number, 0-99 Rec No Record number within the plot, 1-9999 Day Day of month, 1-31 Mo Month, 1-12 Hr Hour in 24-hour format, 0-23 Min Minute, 0-59 CO₂ Ref CO₂ concentration in ppm (equivalent to µmol mol⁻¹) H₂O Ref Water vapor in millibars (only if optional RH sensor is fitted) RHT Temperature from RH sensor in °C (if sensor is fitted) A-H Probe-specific fields (see probe type table below) AP Atmospheric pressure in millibars PT Probe type code, 0-11 Columns A through H contain probe-specific data whose meaning depends on the connected sensor:\nType Sensor A B C D E F G H 0 No Sensor (stand-alone) mV Pin 1 mV Pin 2 mV Pin 3 mV Pin 4 mV Pin 5 — — — 1 STP-1 Soil Temp PAR %RH Temp — mV Pin 5 — — — 2 HTR-2 %RH/Temp/PAR PAR %RH Temp — — — — — 3 HTR-1 %RH/Temp/LUX PAR %RH Temp — — — — — 7 PMR-4 Porometer PAR %RH In Temp %RH Out Flow GS — — 8 SRC-1 Soil Respiration PAR %RH Temp DC DT SR Rate — +/- SR Rate 10 50Y %RH/Temp — %RH Temp — — — — — 11 CFX-1 / CPY-3 PAR Evap Rate Temp DC Flow SR Rate Flow Mult. +/- SR Rate The units for each data type are:\nOutput Data Units PAR µmol m⁻² s⁻¹ %RH % Evap Rate mmol m⁻² s⁻¹ × 1000 Temperature °C Flow ml min⁻¹ GS mmol (H₂O) m⁻² s⁻¹ (Stomatal Conductance) SR Rate g CO₂ m⁻² hr⁻¹ for SRC-1; µmol m⁻² s⁻¹ for CPY-3 and CFX-1 DC ppm (change in CO₂ concentration) DT seconds (change in time) +/- 00 = respiration (CO₂ increase), 01 = uptake (CO₂ decrease) For CFX-1/CPY-3, column G contains a flow multiplier (1 or 10) that should be applied to get the true flow rate. Here\u0026rsquo;s a Python function that parses a raw 61-character record:\nArgs: raw (str): The raw serial string (e.g., \u0026#39;R00000...\u0026#39;) Returns: dict: Key-value pairs of parsed sensor data. \u0026#34;\u0026#34;\u0026#34; # Ensure the string is the expected length after stripping newlines clean = raw.strip() if len(clean) != 61: raise ValueError(f\u0026#34;Invalid record length: {len(clean)} characters\u0026#34;) return { \u0026#39;mode\u0026#39;: clean[0], # M (Real-time measurement) or R (Stored record) \u0026#39;plot\u0026#39;: int(clean[1:3]), # Plot Number \u0026#39;record_num\u0026#39;: int(clean[3:7]), \u0026#39;timestamp\u0026#39;: { \u0026#39;day\u0026#39;: int(clean[7:9]), \u0026#39;month\u0026#39;: int(clean[9:11]), \u0026#39;hour\u0026#39;: int(clean[11:13]), \u0026#39;minute\u0026#39;: int(clean[13:15]), }, \u0026#39;co2_ppm\u0026#39;: int(clean[15:19]), \u0026#39;h2o_mb\u0026#39;: int(clean[19:23]), \u0026#39;temperature_c\u0026#39;: float(clean[23:28]) / 10.0, # Fixed point div by 10 # ... (Sensors A-H mapped as integer counts) ... \u0026#39;pressure_mb\u0026#39;: int(clean[56:59]), \u0026#39;probe_type\u0026#39;: int(clean[59:61]) } \u0026#34;\u0026#34;\u0026#34;\u0026#34; Beyond data records, the EGM-4 also sends status messages during startup and operation. A boot message takes the form B,EGM4,\u0026lt;serial\u0026gt;,\u0026lt;firmware\u0026gt; and provides the device\u0026rsquo;s serial number and firmware version. During warmup, you\u0026rsquo;ll see W,TT messages where TT indicates the current cell temperature. The instrument sends I,NN during initialization and Z,NN during zeroing, where NN is a countdown counter. Diagnostic messages beginning with D, contain internal state information documented in the manual on page 38.\nB: Flux Calculation Methods The EGM-4 calculates soil respiration flux by monitoring the rate of CO₂ accumulation inside the closed SRC-1 chamber. The fundamental equation derived from the Ideal Gas Law is:\n\\[F = \\frac{dC}{dt} \\times \\frac{V}{A} \\times \\frac{P}{R \\times T}\\]\nWhere:\n\\(F\\) is the CO₂ flux in g CO₂ m⁻² hr⁻¹. \\(\\frac{dC}{dt}\\) is the rate of change in CO₂ concentration (ppm s⁻¹). \\(V\\) is the total system volume (chamber + tubing). \\(A\\) is the soil surface area enclosed by the chamber. \\(\\frac{P}{RT}\\) converts the concetration change to molar units. Linear vs. Quadratic When you start a measurement using the SRC-1, you\u0026rsquo;ll be prompted to select the fitting method: 1LINEAR 2QUAD?. This selection determines how the EGM calculates the slope (\\(\\frac{dC}{dt}\\)) from the raw concentration data.\n1. Linear Fit (1): This method assumes that the accumulation is a straight line (\\(C = C_0 + kt\\)). You should choose it for short measurement periods, typically under 2 minutes, or low-flux soils.\n2. Quadratic Fit (2): As CO₂ accumulates in the chamber, the concentration gradient decreases, causing the flux rate to slow down or level off. This method accounts for this by fitting a curve to the data (\\(C = C_0 + kt + ct^2\\)).\nIf you select Quadratic fit and the curvature is excessive (specifically, if the quadratic term \\(ct\\) exceeds 20% of the linear term \\(b\\)), the EGM will yell NON LINEAR FIT. This indicates a significant leak or chamber saturation. Chamber Corrections For the SRC-1, the default chamber volume is 1171 ml with a soil contact area of 78.5 cm² (corresponding to the 10 cm diameter opening). Tubing typically adds 50–100 ml to the total volume. If you\u0026rsquo;re using a custom chamber setup, calculate the total volume as the chamber volume plus the tubing volume, where tubing volume can be calculated as \\(V_{tubing} = \\pi r^2 L\\) with \\(r\\) being the internal radius and \\(L\\) the total length in centimeters.\nTemperature should really be measured inside the chamber using the RH/Temp sensor or an STP-1 probe, because the sample air temperature directly affects the flux calculation.\nThe EGM-4 measures atmospheric pressure internally and applies corrections automatically. At higher elevations, pressure drops significantly: approximately 900 mb at 1000 m and 800 mb at 2000 m compared to 1013 mb at sea level. This affects how many CO₂ molecules occupy a given volume.\nWorked Example Flux is measured by placing a closed chamber on the soil and monitoring the rate of CO₂ concentration increase inside the chamber. Assuming a well-mixed, sealed system:\n\\[R = \\frac{(C_n - C_0)}{T_n} \\times \\frac{V}{A}\\]\nwhere \\(R\\) is the flux (CO₂ per unit area per unit time), \\(C_0\\) is the initial CO₂ concentration, \\(C_n\\) is the concentration after time \\(T_n\\), \\(V\\) is the total system volume, and \\(A\\) is the exposed soil area.\nOver short measurement periods with small concentration changes relative to soil CO₂ levels, flux should be constant, giving a linear concentration increase. However, any chamber leakage causes the apparent flux to decrease with time, producing a curved response. Fitting a quadratic equation \\(C = a + bT + cT^2\\) between concentration and time allows extraction of the true initial flux rate.\nSince \\(\\frac{dC}{dT} = b + 2cT\\), at time \\(T = 0\\) we have \\(\\frac{dC}{dT} = b\\). This gives the instantaneous flux rate before leakage effects accumulate and become a problem. Comparing the magnitude of \\(cT\\) to \\(b\\) indicates leakage severity—the EGM will yell NON LINEAR FIT at you if \\(cT\\) exceeds 20% of \\(b\\).\nFrom the basic equation, \\(R = b \\times \\frac{V}{A}\\). To express flux in mass per unit area per unit time, the rate \\(b\\) must be in mass per unit volume. The CO₂ analyzer measures volume/volume ratio (ppm by volume = µL/L = µbar/bar = µmol/mol).\nOne kilogram-mole of gas (44.01 kg of CO₂) occupies 22.41 m³ at STP. The full conversion equation is:\n\\[R = b \\times \\frac{P}{1000} \\times \\frac{273}{273 + T_a} \\times \\frac{44.01}{22.41} \\times \\frac{V}{A}\\]\nwhere \\(R\\) is flux in kg m⁻² s⁻¹, \\(b\\) is measured as ppm s⁻¹, \\(P\\) is atmospheric pressure in mb, \\(T_a\\) is air temperature in °C, \\(V\\) is system volume in m³, and \\(A\\) is exposed area in m².\nIn practice, the EGM measures \\(\\frac{dC}{dt}\\) in ppm/second, \\(V\\) in cm³, and \\(A\\) in cm². Results are expressed as g m⁻² hr⁻¹. To convert g m⁻² hr⁻¹ to µmol m⁻² s⁻¹, multiply by 6.312.\nEnvironmental correction notes:\nWater Vapor: Adding water vapor to dry air dilutes the CO₂ concentration because the total air volume increases. From an infrared measurement perspective, water vapor induces a slight increase in CO₂ absorption (foreign gas broadening) that approximately cancels the dilution effect. The net result is that the analyzer reports approximately the dry-gas concentration.\nAtmospheric Pressure: Increased pressure raises concentration according to the Gas Law, but infrared absorption increases more than expected due to pressure broadening of absorption bands. The approximate correction is:\n\\[C = C_M \\times \\frac{1000}{0.75P + 0.00025P^2}\\]\nwhere \\(C\\) is the concentration that would be measured at 1000 mb and \\(C_M\\) is the concentration measured at \\(P\\) mb.\nAir Temperature: With the EGM\u0026rsquo;s thermostatted detector at 45°C, the primary temperature effect is on gas density, following the Gas Law (approximately −0.3% per °C increase). The correction referenced to calibration at 0°C is:\n\\[C = C_M \\times \\frac{273 + T_a}{273}\\]\nWhen all corrections are applied, the complete equation becomes:\n\\[R = b \\times \\frac{1000}{1000} \\times \\frac{1000}{P(0.75 + 0.00025P)} \\times \\frac{273 + T_a}{273} \\times \\frac{273}{273 + T_a} \\times \\frac{44.01}{22.41} \\times \\frac{V}{A}\\]\nSimplifying:\n\\[R = \\frac{b \\times 44.01 \\times V}{(0.75 + 0.00025P) \\times 22.41 \\times A}\\]\nThe temperature corrections cancel, and the pressure effect is small. When calibrating at high altitude, the simplified form uses average atmospheric pressure at that altitude:\n\\[R = b \\times \\frac{P_{av}}{1000} \\times \\frac{44.01}{22.41} \\times \\frac{V}{A}\\]\nMeasurement accuracy can be compromised by chamber leaks (which typically cause underestimation), temperature gradients inside the chamber (like being exposed to direct sunlight), pressure fluctuations from wind or weather changes, and non-representative soil coverage due gaps in the collar seal. Make sure your Blue Tack is firmly pressed into place and isn\u0026rsquo;t leaving any holes. C: Probe Types Reference (0-11) The EGM-4 automatically identifies connected sensors by reading a code resistor on Pin 1 of the 15-pin connector. When you power on the device with a sensor attached, the startup screen displays \u0026ldquo;PROBETYPE X\u0026rdquo; where X is the detected type number from the table below:\nType Sensor/Probe Code Resistor Typical Use 0 No sensor None Stand-alone CO₂ analyzer 1 STP-1 Soil Temperature 100 kΩ Soil temperature logging 2 HTR-2 RH/Temp/PAR 56 kΩ Environmental monitoring 3 HTR-1 RH/Temp/PAR 36 kΩ Environmental monitoring (legacy) 4 PAR-1 Light Sensor 27 kΩ PAR (photosynthetically active radiation) 5 PAR-1 LUX 20 kΩ Light intensity in lux 6 SRM-1 15 kΩ Solarimeter 7 PMR-4 Porometer User-set Leaf stomatal conductance 8 SRC-1 Soil Respiration 9.1 kΩ Closed-system soil CO₂ flux 9 RH/T/O₂ 20 kΩ Humidity, temp, oxygen 10 50Y RH/Temperature 5.6 kΩ Humidity and temperature only 11 CFX-1 / CPY-3 4.3 kΩ Open-system flux chambers For Type 2, 3, and 10 sensors, the raw millivolt readings can be converted to physical units using these relationships: PAR equals the millivolt reading multiplied by 3 (giving µmol m⁻² s⁻¹), relative humidity equals the millivolt reading divided by 10 (giving percent), and temperature equals the millivolt reading divided by 20 (giving °C).\nIf you\u0026rsquo;re using non-PP-Systems sensors or need to override auto-detection (for Type 0 or 7), you can manually set the probe type through Menu 2 (SET), then option 1 (EGM), where you select stand-alone mode, probe mode, or porometer mode.\nCustom sensors can be connected to the I/O ports, which accept 0–1V input signals. The readings appear as millivolt values (0–1000 mV) in the A through E fields of data records. When using custom sensors, ensure your output is scaled to the 0–1V range and apply your own conversion factors during post-processing.\nD: Water Vapor \u0026amp; Temperature Corrections CO₂ measurements are affected by both water vapor and temperature. The EGM-4 applies corrections automatically when appropriate sensors are connected, but understanding these effects helps in troubleshooting anomalous readings.\nWater vapor dilutes the mole fraction of CO₂ in air. The relationship between wet and dry CO₂ concentrations is:\n\\[C_{dry} = \\frac{C_{wet}}{1 - \\frac{e}{P}}\\]\nHere, \\(C_{dry}\\) is the CO₂ concentration in dry air (ppm), \\(C_{wet}\\) is the measured concentration in humid air, \\(e\\) is water vapor pressure in millibars, and \\(P\\) is total atmospheric pressure in millibars.\nAs a practical example: if you measure 400 ppm CO₂ in air with 20 mb of water vapor at 1013 mb total pressure, the correction factor is \\(1 - (20/1013) = 0.980\\), giving a dry-air equivalent of \\(400 / 0.980 = 408\\) ppm. The EGM-4 applies this correction automatically when an RH/Temp sensor is connected; without the sensor, no correction is applied.\nTemperature affects CO₂ measurements in several ways. Colder air has higher gas density (more molecules per unit volume), detector sensitivity varies with temperature, and temperature is a direct input to flux calculations. To minimize temperature effects on the IRGA itself, the EGM-4 thermostatically maintains the sample cell at 55°C.\nFor best results, always use an RH/Temp sensor for accurate measurements, record the temperature inside the chamber (using an STP-1 if available) for flux calculations, and expect 2–4% corrections to CO₂ values when humidity exceeds 90%.\nE: Chamber Volume Calculations Accurate flux measurements depend on knowing the total system volume, which includes both the chamber and all connecting tubing. For the SRC-1, the manufacturer specifies a chamber volume of 1171 ml. Adding the standard tubing (typically 50–100 ml depending on length) gives a total system volume of roughly 1220–1270 ml.\nFor cylindrical chambers, volume is calculated as \\(V = \\pi r^2 h\\), where \\(r\\) is the radius and \\(h\\) is the height, both in centimeters, yielding volume in cubic centimeters (equivalent to milliliters). Tubing volume uses the same formula: \\(V_{tube} = \\pi r^2 L\\), where \\(L\\) is the total tubing length.\nAs an example, 1/8\u0026quot; inner diameter tubing has an internal diameter of 3.175 mm, or a radius of 0.15875 cm. For 100 cm of this tubing, the volume is \\(\\pi \\times (0.15875)^2 \\times 100 = 7.9\\) ml.\nThe soil contact area is similarly calculated as \\(A = \\pi r^2\\). For the SRC-1 with its 10 cm diameter opening, this gives \\(A = \\pi \\times 5^2 = 78.5\\) cm².\nTo enter custom volume and area values in the EGM-4, press 1 (REC) from the Main Menu, then press N at the settings screen to modify values. Press 1 to change volume or 2 to change area, enter your new values, and the EGM-4 will automatically update the V/A ratio used in flux calculations.\nThe volume-to-area ratio determines how quickly CO₂ accumulates for a given flux rate. A high V/A ratio means slower accumulation and longer measurement times, while a low V/A ratio results in faster accumulation. For soil respiration work, typical V/A ratios are around 15 cm; the SRC-1 default is 14.9 cm.\nF: open-egm4 Software Design Philosophy This section explains why open-egm4 was built as a terminal user interface (TUI) and how the software works internally.\nWhy a Terminal Interface? I deliberately chose to use a text-based interface instead of a graphical interface for several reasons.\nChiefly, keep it simple, stupid. Additionally, it makes cross-platform support automatic, while the previous PP Systems software was Windows-only. It also eliminates dependencies on GUI toolkits, which can be a pain to install and maintain. It allows for remote access via SSH, which could theoretically be useful. I guess. A terminal interface is inherently scriptable and automatable, and it\u0026rsquo;s much easier to fix if something goes wrong.\nAdvantages Over Legacy Windows Software The official PP Systems software is Windows-only and has several limitations. It requires specific .NET framework versions that may conflict with other software, offers no remote access capability, and is closed-source. It also is no longer maintained.\nOpen-egm4 meets and exceeds all of the featues that the official software has to offer.\nOpen-egm4 addresses all of these concerns. It runs on any operating system, is open source under the MIT license, and is actively developed and maintained. The community can contribute features, and it works seamlessly over SSH for remote field sites.\nArchitecture Overview:\nOpen-egm4 is built in Python using the Textual framework for terminal UI rendering.\nThe core serial communication lives in src/egm_interface.py, which defines the EGM4Serial class. This class manages the connection to the EGM-4 via pyserial, parses the incoming 61-character fixed-width data records using position-based slicing, and dispatches parsed data to registered callbacks. The parser handles all probe types (0-11) and extracts fields like CO₂, temperature, humidity, and calculated flux depending on the connected sensor.\nSession persistence is handled by src/database.py, which uses SQLite to store readings across sessions. This allows users to close the app and resume later without losing data. The database stores each reading with its timestamp, plot number, channel values, and session metadata.\nThe TUI itself is composed of screens and widgets in the src/tui/ directory. The main application entry point is src/tui/app.py, which sets up the Textual app and manages screen transitions. Key screens include the connection screen (screens/connect.py), the main monitor screen (screens/monitor.py), the export wizard (screens/export.py), and big mode (screens/big_mode.py).\nThe monitor screen orchestrates real-time display by wiring the serial handler to the chart widget (widgets/co2_chart.py), which renders data using plotext for ASCII plotting. Statistics are calculated and displayed by widgets/stats.py, and the channel legend is managed by widgets/legend.py.\nExport functionality converts session data to CSV format, allowing users to filter by plot number and date range before saving.\nData Flow:\n+----------+ +------------+ +------------------+ | EGM-4 | --\u0026gt; | EGM4Serial | --\u0026gt; | Parser | +----------+ +------------+ +------------------+ | (Parsed Dict) v +-------------------------+ | Textual Event Loop | +-------------------------+ / \\ v v +------------+ +-----------------+ | Database | | MonitorScreen | +------------+ +-----------------+ | / | \\ v CO2 Stats Legend +------------+ Chart | SQLite DB | +------------+ Created in Doom Emacs 2.0.9, using org-mode 9.7.\nWritten in January 2026.\nCreated by Morgan Salisbury 😊🐇⛵️🏔️❤️\n","permalink":"https://docs.mor-gan.com/posts/using-the-egm-4/","summary":"\u003cdiv class=\"alert alert-Warning\"\u003e\n  \u003cstrong\u003eBackup your data regularly.\u003c/strong\u003e  The EGM-4\u0026rsquo;s internal memory is limited to 1,500 records across up to 99 plots. Failing to dump data regularly will result in data loss when this buffer fills. When memory is full, the oldest records are overwritten.\n\u003c/div\u003e\n\u003cdiv class=\"alert alert-Warning\"\u003e\n  \u003cstrong\u003eYou are responsible for your data.\u003c/strong\u003e Significant care has been taken to ensure data safety. However, by using the open-egm4 software, you accept the risk of data loss. Open-egm4 can not send commands to the EGM-4 itself, and therefore cannot damage it internally.\n\u003c/div\u003e\n\u003cdiv class=\"alert alert-Caution\"\u003e\n  \u003cstrong\u003eDon\u0026rsquo;t get water in the gas lines.\u003c/strong\u003e If you do, it might enter the IRGA itself and damage it. It\u0026rsquo;s like $15,000 to replace.\n\u003c/div\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eThe PP Systems EGM-4 (EGM) is a portable infrared gas analyzer (IRGA) designed for measuring soil CO₂ efflux. The device connects to various chamber types and soil probes, and stores measurements in its internal memory.\u003c/p\u003e","title":"Using the EGM-4 \u0026 open-egm4 software"},{"content":"Introduction Goal: To create animations of soil cores spinning from .vol files obtained from the Pacific Northwest National Laboratory.\nWe\u0026rsquo;re getting our files from the Environmental Molecular Sciences Laboratory at the Pacific Northwest National Laboratory, who have scanned the soil cores with a Nikon XTH CT scanner.\nRequirements .vol files from a CT scanner At least 16gb of memory Ideally more. Both Fiji and Dragonfly attempt to load the entire file into memory; the downloaded .vol is almost 40gb. Dragonfly from Comet Software. You\u0026rsquo;ll need a license: 30 day free trials are easily accessible, and non commercial licenses are available. Fiji or ImageJ, but use Fiji. A windows or Linux machine to run Dragonfly on; everything but that can be done on Mac TL;DR Download .vol files from EMSL Data portal Import the files into Fiji as raw data, 2000x2000x2000 Convert to 8-bit, save as .tiff Open the .tiff in Dragonfly, crop to slices 250-1800 Make a cylindrical mask to crop the garbage off the core Use movie maker to make a rotating movie, export to .avi Use ffmpeg or similar to convert to mp4 Use kdenlive or similar to crop to square Use Gifski to convert to reasonably sized gif Getting .vol files from EMSL data portal Selecting cores To start, we need to get the CT scan files from EMSL, provided as .vol files.\nNavigate to the EMSL data portal, and login. On the left hand side of the screen, open the Project drawer and scroll down to the Principle Investigator field. Enter the first few characters of a name, and then check the cooresponding box. The main panel should update with the relevant project. Scroll down to the Select Datasets button, and click it. You should now see a list of the datasets associated with that project. In this example, we\u0026rsquo;re looking for individually numbered soil cores, but you will note that none of the data are labeled.\nIf you have a specific core number in mind, the only way to locate it is by looking inside of every single dataset by clicking the DOI button next to the Upload ID. You can then see the individual file names, which include the soil core number. If you decide to embark on a search to find a soil core, I recommend sorting by Instrument to only see XCT data, and then sort by file size. You are looking for datasets that are 29.8GB. Only view 10 datasets per page, as when you exit the DOI file viewer the entire webpage snaps to the top; it\u0026rsquo;s easier to keep track of where you are when there are only 10 items.\nOnce you find the core you want, note the Upload ID. To search for an ID you already know, set Items per page to All, and use cmd + f.\nSome known core ID\u0026rsquo;s:\nCore # Bottom Top 1 3132984 2 3134562 5 3135086 6 3135290 7 3049610 10 3133330 11 3051409 3051495 15 3010819 3010713 16 3011663 3013268 20 3010658 3010660 Some notes:\nEach core is 30cm tall, and the bottom 10cm and top 10cm were scanned. Each core is 7.62cm in diameter. 2000 slices per scan, meaning that each slice is 50µm (0.05mm) thick. If a core (including 1 \u0026amp; 6 listed above) is difficult to use or is seemingly empty, it\u0026rsquo;s most likely because the soil profile wasn\u0026rsquo;t tall enough for a full sample to be taken. Downloading cores Add each dataset to your cart by checking the box next to it. To download the cores, you will need to set up and use Globus.\nOnce EMSL prepares the files, you will see a link to go to the created guest collection. Open it, and navigate to your endpoint (computer) on the pane without the .tar in it. Go to the folder where you want the files to be downloaded to. Once there, select the tar on the other pane, hit Transfer or Sync to... in the middle, and then click start above the pane.\nGlobus will start transferring the file. You should get an email when its done. For reference, a 96GB transfer took a little over three and a half hours.\nInitial .vol work in Fiji Unzip the tarball, and navigate through the mess of folders inside to get to the .vol files (each should be around 30GB). I recommend moving the .vols into their own folder, separate from the tarball\u0026rsquo;s filesystem, because it\u0026rsquo;s obnoxious to have to go 30 directories deep to get to them.\nNotes:\nEach .vol has a corresponding .vgi that contains metadata about the .vol. Open it in a text editor if you want to know more. There are a number of other derived products in the tar, namely still images of the core and csv files with data (notably porosity). Each .vol contains 2000 images, each of which is 2000x2000 pixels, totalling 8 billion voxels, each of which is represented as a 32-bit floating-point number and saved in an uncompressed file. This makes the raw files wildly impractical to work with, hence the use of Fiji. The goal is to convert each file to 8-bit and save it as a .tiff, both of which should drastically reduce the size while losing no useable data.\nOpen Fiji, and use File \u0026gt; Import \u0026gt; Raw... to open the .vol.\nImage type: 32-bit Real Width: 2000 Height: 2000 Offset: 0 Number of images: 2000 Gap: 0 Check Little-endian byte order and Use virtual stack. Virtual stacks load the images without fully committing them to memory, making it possible to view datasets that are larger in size than the amount of memory you have. If you don\u0026rsquo;t have at least 40GB of memory and don\u0026rsquo;t use virtual stacks, Fiji will crash your system attempting to load the file.\nFiji will open the file, and you should be able to scroll through the slices of the core, or use the scroll bar at the bottom of the window containing the core.\nTo convert the file to 8-bit, use Image \u0026gt; Type \u0026gt; 8-bit. This will take time: you should be able to see Fiji converting images by the hundreds on the main toolbar.\nYou should now have an updated view of the core; notice the reduced file size displayed in the window title. To save as a .tiff, use File \u0026gt; Save as \u0026gt; Tiff...\nWorking in Dragonfly Loading \u0026amp; masking In Dragonfly, open the newly created .tiff file with File \u0026gt; Import Image Files.... Click the Add... button, then select the file. Click Next in the bottom right.\nThe fields on this screen should be correct. Ensure that the Total size (on right, under Information) is less than the amount of memory you have.\nClick Crop Image... and preview the image of the soil core. If the core doesn\u0026rsquo;t take up most of the frame, crop it by dragging the green dotted edges or corners inward.\nIn the Crop Image... window, crop the image to slices 250-1800. Under the Cropping slider, enter 250 in the first field and 1800 in the second. Click OK.\nClick Finish. After loading, you should see four views of the core: a 3D render and three orthogonal views. You can maximize a pane by double clicking, and you can move the 3D view by clicking and dragging in its pane. Double click again to return to all four views.\nNotice the \u0026ldquo;fuzziness\u0026rdquo; or garbage data visible in the 3D view (most visible looking top down, around the edges). To remove this data, we need to create a cylindrical mask.\nAt the top of the 3D view, there is a row of buttons under the Shapes bar. Click the cylinder button, the third from the left - note the capsule button right next to the cylinder button.\nYou should see a wireframe cylinder insdie of the soil core. Using one of the side orthogonal views, drag the green lines outward, and stop when you hit the garbage data.\nYou should see the cylinder on the other views increasing and get a sense of what you\u0026rsquo;re doing. Everything outside the cylinder will be excluded.\nOn the right hand side of the screen, you should see a list of the objects loaded: the core and the cylinder. Click on the cylinder, and look under Shape properties, Visual effects, Visuals. Check the box next to the core. Check Outside, then under 3D effects, Clip. You should see the 3D view update to exclude anything outside the cylinder.\nAnimating Right click the 3D view and select Show Movie Maker. Double click the 3D view pane to maximize it. You\u0026rsquo;ll need to position the 3D view to be what you want the video to look like: I position the core straight on, with the camera slightly raised above it at an angle so the top is visible.\nClick and drag to manipulate the core, and click and hold the middle mouse button and move your cursor up and down to zoom in and out. To physically move the core in the 3D space, press x on your keyboard and click and drag. Make sure to press escape when you are done moving it to return to the default track tool.\nOnce you\u0026rsquo;ve positioned the core, look at the timeline near the bottom of the screen. At the 00:00 mark, you should see a square with a picture of the core in it. Right click it, and select Update key frame.\nTo actually rotate the core, click the Rotate button above the timeline. Choose one of the two right-most options (I use clockwise), and select Rotate around the object's axis. A second image, or keyframe, should appear on the timeline. Drag this second keyframe out to around the 20 second mark, or however long you want the video to be.\nThe original keyframe is where the animation will start, and the ending keyframe is exactly the same except that the core has been rotated 360 degrees. Dragonfly interpolates the motion in between the keyframes, so by dragging the 2nd keyframe further out along the timeline you are causing the core to spin slower.\nYou can drag the green bar marker along the timeline to preview the animation, or click the play symbol above the timeline. Note that the animation likely will not play at full speed, as it\u0026rsquo;s rendering in real time.\nTo change the color of the background to a solid white, click the Scene's Views Properties bar in the left list of toolbars. Near-ish the top is a button next to Background color. In the window, you\u0026rsquo;ll want to select Uniform under mode, and then click the button next to Color 1 in the Color section on the right. In the color picker, drag the right mode slider up from black to white, and click OK, then OK. You should see the updated background.\nTo export the animation, click the Export animation symbol above the timeline, immediately next to the start / beginning symbol. Set the FPS to 60, the Dimensions preset to 1920x1080, and the bitrate to High. Click Save as Video File. Once you\u0026rsquo;ve given a name and location for the file, Dragonfly will render and export the animation as an .avi file.\nWorking with .avi video files. Once you have the exported .avi files, the goal is now to convert them into a more common, useable format. If you want to create .gif files out of the animations, a few different steps are needed. In general, you need to:\nConvert the .avi into a more useable format (.mp4) Crop the new .mp4 into the a square aspect ratio. This looks nice, and crops out the small cube axis visualizer in the bottom right of the frame. Convert the .mp4 into a .gif. These steps can be completed in a little over 3 trillion different ways. In this guide, I\u0026rsquo;ll use ffmpeg for converting files, kdenlive for cropping, and Gifski for making the .gifs, but it\u0026rsquo;s practically much easier to use software like Adobe Premiere Pro or Final Cut Pro (free 90 day trial!) if you have access to them.\nYou can get ffmpeg from their website, or install it (on mac) with homebrew by running brew install ffmpeg in a terminal. Kdenlive is available online. Gifski is available on the mac app store (link on GitHub)\nI would recommend working in a folder where all of your video files are, which prevents you from needing to type out full paths for the following commands.\nConverting .avi to .mp4 with ffmpeg To convert an .avi into a .gif:\nffmpeg -i input.avi -vcodec libx264 -crf 23 -preset medium output.mp4 where input.avi is the .avi file and output.mp4 is the desired output file.\nWith the new .mp4, you can move on to cropping.\nCropping with Kdenlive In kdenlive, add the clip to the timeline with Project \u0026gt; Add Clip or Folder..., then select the .mp4. If you get prompted to Switch to clip profile HD 1080p 60 fps, click cancel. Instead, we want to change the project to be a square aspect ratio.\nNavigate to Project \u0026gt; Project Settings..., then under the list of folders of profiles, scroll down to Custom, open the folder, and select Square 1080p 60 fps. Click OK, then confirm.\nIn the top left panel, you should see the .mp4 under the Sequences folder. Drag it to the V1 timeline, highlighted in blue. Be sure to drag it to the far left, so that it starts at 0:00.\nThe vertical white line is your Playhead, which represents where in the video the preview monitor is showing. Drag the top of the playhead on the timeline to skim through the video.\nNote that there are two soil cores on your screen: The monitor on the left is displaying the source clip, while the one on the right is displaying your entire project. Once we apply effects (cropping the video), you\u0026rsquo;ll be using the monitor on the right for reference.\nTo do this, go to the Effects tab, underneath the far top left panel, about halfway down your screen. Use the search field at the top to search for Transform, and double click it. You should notice that the effect appears on the list of effects to the right of the timeline.\nIn that panel, change the Size variable to 179%. The core should now fill the frame. Use your spacebar as a play/pause button and you should see the soil core rotating.\nAt this point, the video should be complete and ready to export. To do this, go to Project \u0026gt; Render..., and select the MP4-H264/AAC preset. Click the small file button next to the Output file field to select where you want to save the file. Once you are done, click the Render to File button at the bottom left of the window to start rendering.\nConverting a .mp4 file to a .gif with Gifski Open Gifski, and either drag the cropped .mp4 into the window or select it with the file picker. The app is incredibly simple to use compared to the stuff that was happening up there. There is a quality slider, and an estimated file size. I would set the fps to 50 to make it as smooth as possible.\nSmash Convert once you are happy with the estimated size, and enjoy.\nWooo!!!!\n","permalink":"https://docs.mor-gan.com/posts/creating-animations-of-soil-cores/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eGoal: To create animations of soil cores spinning from .vol files obtained from the Pacific Northwest National Laboratory.\u003c/p\u003e\n\u003cp\u003eWe\u0026rsquo;re getting our files from the Environmental Molecular Sciences Laboratory at the Pacific Northwest National Laboratory, who have scanned the soil cores with a Nikon XTH CT scanner.\u003c/p\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e.vol files from a CT scanner\u003c/li\u003e\n\u003cli\u003eAt least 16gb of memory\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://downloadmoreram.com/\"\u003eIdeally more\u003c/a\u003e. Both Fiji and Dragonfly attempt to load the entire file into memory; the downloaded .vol is almost 40gb.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://dragonfly.comet.tech/\"\u003eDragonfly from Comet Software\u003c/a\u003e. You\u0026rsquo;ll need a license: \u003ca href=\"https://www.theobjects.com/dragonfly/get-trial-version-request-comet.php\"\u003e30 day free trials\u003c/a\u003e are easily accessible, and \u003ca href=\"https://dragonfly.comet.tech/en/non-commercial-licensing\"\u003enon commercial licenses are available\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://fiji.sc/\"\u003eFiji\u003c/a\u003e or ImageJ, but use Fiji.\u003c/li\u003e\n\u003cli\u003eA windows or Linux machine to run Dragonfly on; everything but that can be done on Mac\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"tl-dr\"\u003eTL;DR\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eDownload .vol files from \u003ca href=\"https://sc-data.emsl.pnnl.gov/#state=32f73ab7-1755-4bad-8f02-a5640adf3a1a\u0026amp;session_state=0f3eb580-fa1b-48b2-aed4-6eefcad788f9\u0026amp;code=6f48e754-f383-442b-884b-f7222be36fbe.0f3eb580-fa1b-48b2-aed4-6eefcad788f9.21cf84f6-6ada-4d20-8b12-72f0a3e0bce3\"\u003eEMSL Data portal\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eImport the files into Fiji as raw data, 2000x2000x2000\n\u003cul\u003e\n\u003cli\u003eConvert to 8-bit, save as .tiff\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOpen the .tiff in Dragonfly, crop to slices 250-1800\n\u003cul\u003e\n\u003cli\u003eMake a cylindrical mask to crop the garbage off the core\u003c/li\u003e\n\u003cli\u003eUse movie maker to make a rotating movie, export to .avi\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUse ffmpeg or similar to convert to mp4\u003c/li\u003e\n\u003cli\u003eUse kdenlive or similar to crop to square\u003c/li\u003e\n\u003cli\u003eUse Gifski to convert to reasonably sized gif\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"getting-dot-vol-files-from-emsl-data-portal\"\u003eGetting .vol files from EMSL data portal\u003c/h2\u003e\n\u003ch3 id=\"selecting-cores\"\u003eSelecting cores\u003c/h3\u003e\n\u003cp\u003eTo start, we need to get the CT scan files from EMSL, provided as .vol files.\u003c/p\u003e","title":"Creating animations of soil cores out of CT scans"},{"content":"Warning: The XRF emits X-rays up to 50kV. Improper use can and will cause serious, long term harm to your health. Follow all safety protocols including those beyond this article.\nIntroduction This article assumes you already are in possession of pucks of finely ground soil.\nProcedure Prepare the XRF Analyzer\nTake the battery from the charger and insert it into the back of the XRF. Note that a good amount of force is required to latch the battery into place. Power on the XRF by holding the power button on the left of the front for about 3 seconds. Wait for the system to boot. Log into the device using the password. The four directional buttons are used to select items on the interface. The button to the right of the pad is the enter or confirm button, not a back button. The center of the pad is not a button, which is incredibly unintuitive and confused me for an unbelievably long period of time. From the main menu, select System Check to calibrate the scanner. Connect the XRF to a Computer\nOpen the NDTr software from the start menu on the desktop. It should automatically connect to the XRF and mirror the device’s screen on the computer. If it doesn\u0026rsquo;t, try some of the following. The software should be the only XRF-related piece of software open. If something else is open trying to communicate with the scanner, it won\u0026rsquo;t work. The scanner should be communicating on COM6. To ensure this is the case or to change it: Maximize the window with the window decoration controls (e.g. _ □ ☒) Click the now visible settings button. Change the COM port to 6. If it still won\u0026rsquo;t work, ensure that the XRF is actually communicating on COM6. Open Device Manager (search in start menu), and under \u0026ldquo;Universal Serial Bus\u0026rdquo;, look for the scanner. Note the COM port. Prepare and Name the Samples\nSlide the latch on the XRF stand to the right and open the lid. Place your sample puck on the XRF with the film side facing down. Close the lid and lock it by sliding the latch back to the right. Navigate to the Sample Type menu and select Soils and Minerals, then choose Soils. Navigate to Data Entry, and click the glyph of the keyboard to enter the sample\u0026rsquo;s name. Note that you can use the computer\u0026rsquo;s keyboard to type. Perform the Scan\nEnsure that the sample is centered on the sensor and that the lid is locked, then press and hold the trigger. The XRF will scan as long as you are holding the trigger, up to 10 seconds. Ensure you hold the trigger for the same amount of time for all samples in a batch. The longer the scan, the more accurate the results are, although scanning for more than 5 seconds is essentially redundant. After the scan completes, open the lid and remove the sample, placing it on the lab bench film-side up. Note: placing the sample film side down can easily destroy the puck. Press the return key on the computer keyboard. Enter a new sample name, and continue with the next sample. Download the Data from the XRF\nOnce all samples have been scanned, click the Disconnect button on the computer and close the NDTr software. Open the NDT software. The XRF should be connected to COM6. Click Test to verify the connection. If successful, click Query Readings to retrieve the data from the XRF. Scroll to the bottom of the readings list, select the samples you need, name the file, and click Download to save the data. .ndt files can be opened in Excel or your text editor of choice. ","permalink":"https://docs.mor-gan.com/posts/analyzing-soil-with-xrf/","summary":"\u003cp\u003e\u003cstrong\u003eWarning\u003c/strong\u003e: The XRF emits X-rays up to 50kV. Improper use can and will cause serious, long term harm to your health. Follow all safety protocols including those beyond this article.\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eThis article assumes you already are in possession of pucks of finely ground soil.\u003c/p\u003e\n\u003ch2 id=\"procedure\"\u003eProcedure\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003ePrepare the XRF Analyzer\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTake the battery from the charger and insert it into the back of the XRF.\n\u003cul\u003e\n\u003cli\u003eNote that a good amount of force is required to latch the battery into place.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePower on the XRF by holding the power button on the left of the front for about 3 seconds.\u003c/li\u003e\n\u003cli\u003eWait for the system to boot.\u003c/li\u003e\n\u003cli\u003eLog into the device using the password.\u003c/li\u003e\n\u003cli\u003eThe four directional buttons are used to select items on the interface.\u003c/li\u003e\n\u003cli\u003eThe button to the right of the pad is the enter or confirm button, not a back button.\u003c/li\u003e\n\u003cli\u003eThe center of the pad is not a button, which is incredibly unintuitive and confused me for an unbelievably long period of time.\u003c/li\u003e\n\u003cli\u003eFrom the main menu, select \u003ccode\u003eSystem Check\u003c/code\u003e to calibrate the scanner.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eConnect the XRF to a Computer\u003c/strong\u003e\u003c/p\u003e","title":"Analyzing soil with a XRF"},{"content":"Introduction to Git and GitHub It\u0026rsquo;s easiest to think of Git (and other forms of source control) like a time machine.\nWhen you make changes to your project, it\u0026rsquo;s easy to see what has changed. You have a perfect history of everything that\u0026rsquo;s ever happened in your project, and can always revert to any point in that history. Git allows you to work with other people on the same project, while guaranteeing that you won\u0026rsquo;t mess up each other\u0026rsquo;s work. Git allows you to send and receive files from your computer to a server, making it easy to put your projects online. Concepts Commits: Think of a commit as taking a snapshot of your project. Every time you make a commit, you are saving a record of what your project looks like at that moment in time. This allows you to track changes over time and gives you a perfect history of your entire project.\nRepositories: Where your project lives. It’s like a folder that stores all of your code and the entire history of your project. Repositories can live on your local machine or be hosted online via platforms like GitHub.\nStaging Area: The staging area is like a holding ground where you prepare changes before making a commit. Think of it as packing a suitcase for a trip. When you lay everything out on your bed, thinking about what you want to bring with you, you can still move around, remove, and add items. The bed would be the staging area, and \u0026ldquo;committing\u0026rdquo; would be closing and locking your suitcase.\nHow GitHub Works GitHub stores your Git repository online. While Git is entirely local (everything is stored on your computer), GitHub hosts your repository online so that you can share it and collaborate with other people.\nBranches and Pull Requests In Git, branches allow you to work on different versions of your project simultaneously. For example, if you are working on a major feature but you don’t want to disrupt the rest of the project, a branch would allow you to create an alternate timeline where you can make changes without affecting the main project.\nPull Requests are used when working with other people to propose changes. If someone has code that they want to contribute to the project, they create a pull request to merge their work. This allows other team members to review the code before it’s integrated.\nGlossary Core Git Terms:\nRepository (Repo): A project’s directory or storage space where your project’s files and their revision history are stored. Commit: A snapshot of your project at a specific point in time. Each commit has a message and stores changes made to the code. Branch: A separate line of development within the same repository. You can think of branches as different versions of your project that diverge from the main version (typically called main or master). Clone: The process of creating a local copy of a repository from a remote server (such as GitHub). Fork: A personal copy of someone else’s repository, typically used to suggest changes or to start independent development. Pull Request (PR): A GitHub-specific feature. It allows developers to request that their code changes be merged into the main repository. It often involves code review before merging. Merge: The process of combining changes from different branches into one. It typically happens after a pull request is approved. Rebase: Similar to merging but instead of combining the changes from different branches, it rewrites the commit history by applying your changes on top of another branch. Useful for keeping a cleaner commit history. Remote: A version of your project hosted on a remote server (such as GitHub, GitLab, or Bitbucket). The remote is usually referred to as origin. Fetch: Retrieves the latest changes from the remote repository without applying them to your local repository. Pull: Retrieves the latest changes from the remote repository and applies them to your current branch. Push: Sends your committed changes to a remote repository (e.g., GitHub) so others can access them. HEAD: The current snapshot or commit that your working directory is based on. It’s typically the latest commit on the active branch. Staging Area: A place where you prepare changes before committing them. Think of it as a holding area where you decide what will go into your next commit. Index: Another name for the staging area. Checkout: The process of moving between different branches or commits in a repository. You are switching your working directory to match a particular branch or commit. Conflict: Occurs when Git is unable to automatically resolve differences between two commits (such as during a merge) because the same line of code was changed differently in both branches. Cherry-pick: Selectively applying changes from one commit in another branch without merging the entire branch. ","permalink":"https://docs.mor-gan.com/posts/git-basics/","summary":"\u003ch2 id=\"introduction-to-git-and-github\"\u003eIntroduction to Git and GitHub\u003c/h2\u003e\n\u003cp\u003eIt\u0026rsquo;s easiest to think of Git (and other forms of source control) like a time machine.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWhen you make changes to your project, it\u0026rsquo;s easy to see what has changed.\u003c/li\u003e\n\u003cli\u003eYou have a perfect history of everything that\u0026rsquo;s ever happened in your project, and can always revert to any point in that history.\u003c/li\u003e\n\u003cli\u003eGit allows you to work with other people on the same project, while guaranteeing that you won\u0026rsquo;t mess up each other\u0026rsquo;s work.\u003c/li\u003e\n\u003cli\u003eGit allows you to send and receive files from your computer to a server, making it easy to put your projects online.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"concepts\"\u003eConcepts\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eCommits:\u003c/strong\u003e Think of a commit as taking a snapshot of your project. Every time you make a commit, you are saving a record of what your project looks like at that moment in time. This allows you to track changes over time and gives you a perfect history of your entire project.\u003c/p\u003e","title":"Git basics"},{"content":"Introduction \u0026ldquo;Keyhole Markup Language\u0026rdquo;\n.kml files are useful for a number of reasons, namely storing pins, locations, polygons, images, and other GIS info. One of the easiest ways to make them is with Google Earth.\nYou can approach this in a couple of ways. Both the Earth website and the Google Earth Pro desktop app are usable.\nGoogle Earth Web Open Google Earth in a browser. Open the left hand side bar. It\u0026rsquo;s a little arrow in the middle of the left edge. Click the \u0026ldquo;+ New\u0026rdquo; button, select \u0026ldquo;Local KML file\u0026rdquo;, and click \u0026ldquo;Create\u0026rdquo;. You should see a new section, \u0026ldquo;Local KML files\u0026rdquo;, and your new project, \u0026ldquo;Untitled\u0026rdquo;. You can rename the project by clicking on the kebab menu while hovering on it, and clicking \u0026ldquo;Rename\u0026rdquo;. Click on the project to select it. To add a location to the project, navigate to it, and then click the \u0026ldquo;Save to project\u0026rdquo; button that appears in the card. Alternatively, you can use the pin / placemark tool (first on the left in the toolbar) and it will be automatically added to the selected project. You can rename the pin / placemark by either doing so when you initially place it, or by using the kebab menu in the project menu. Once you are done adding to your project, you can export by clicking the kebab menu on it, and then selecting \u0026ldquo;Export as KML file\u0026rdquo;. Google Earth Pro Open Google Earth Pro. Create a folder under Add \u0026gt; Folder. This is your project, so name it accordingly. Create placemarks with the placemark tool. They should be automatically placed into the new folder. You can drag other objects inside of the folder to add them to the project. Once you are done with the project, export it by right clicking on the folder and selecting \u0026ldquo;Save place as..\u0026rdquo; There are two options to save: a .kml and .kmz. If you don\u0026rsquo;t know what to use, select .kml. .kmz files are used to compress larger projects, typically ones that include images, but have some compatability issues. ","permalink":"https://docs.mor-gan.com/posts/creating-a-kml-from-a-project/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003e\u0026ldquo;Keyhole Markup Language\u0026rdquo;\u003c/p\u003e\n\u003cp\u003e.kml files are useful for a number of reasons, namely storing pins, locations, polygons, images, and other GIS info. One of the easiest ways to make them is with Google Earth.\u003c/p\u003e\n\u003cp\u003eYou can approach this in a couple of ways. Both the \u003ca href=\"https://earth.google.com\"\u003eEarth website\u003c/a\u003e and the \u003ca href=\"https://www.google.com/earth/about/versions/\"\u003eGoogle Earth Pro desktop app\u003c/a\u003e are usable.\u003c/p\u003e\n\u003ch2 id=\"google-earth-web\"\u003eGoogle Earth Web\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eOpen \u003ca href=\"https://earth.google.com\"\u003eGoogle Earth\u003c/a\u003e in a browser.\u003c/li\u003e\n\u003cli\u003eOpen the left hand side bar. It\u0026rsquo;s a little arrow in the middle of the left edge.\u003c/li\u003e\n\u003cli\u003eClick the \u0026ldquo;+ New\u0026rdquo; button, select \u0026ldquo;Local KML file\u0026rdquo;, and click \u0026ldquo;Create\u0026rdquo;.\u003c/li\u003e\n\u003cli\u003eYou should see a new section, \u0026ldquo;Local KML files\u0026rdquo;, and your new project, \u0026ldquo;Untitled\u0026rdquo;.\n\u003cul\u003e\n\u003cli\u003eYou can rename the project by clicking on the kebab menu while hovering on it, and clicking \u0026ldquo;Rename\u0026rdquo;.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eClick on the project to select it.\u003c/li\u003e\n\u003cli\u003eTo add a location to the project, navigate to it, and then click the \u0026ldquo;Save to project\u0026rdquo; button that appears in the card.\n\u003cul\u003e\n\u003cli\u003eAlternatively, you can use the pin / placemark tool (first on the left in the toolbar) and it will be automatically added to the selected project.\u003c/li\u003e\n\u003cli\u003eYou can rename the pin / placemark by either doing so when you initially place it, or by using the kebab menu in the project menu.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOnce you are done adding to your project, you can export by clicking the kebab menu on it, and then selecting \u0026ldquo;Export as KML file\u0026rdquo;.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"google-earth-pro\"\u003eGoogle Earth Pro\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eOpen \u003ca href=\"https://www.google.com/earth/about/versions/\"\u003eGoogle Earth Pro\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eCreate a folder under Add \u0026gt; Folder. This is your project, so name it accordingly.\u003c/li\u003e\n\u003cli\u003eCreate placemarks with the placemark tool.\n\u003cul\u003e\n\u003cli\u003eThey should be automatically placed into the new folder.\u003c/li\u003e\n\u003cli\u003eYou can drag other objects inside of the folder to add them to the project.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOnce you are done with the project, export it by right clicking on the folder and selecting \u0026ldquo;Save place as..\u0026rdquo;\n\u003cul\u003e\n\u003cli\u003eThere are two options to save: a .kml and .kmz.\u003c/li\u003e\n\u003cli\u003eIf you don\u0026rsquo;t know what to use, select .kml.\u003c/li\u003e\n\u003cli\u003e.kmz files are used to compress larger projects, typically ones that include images, but have some compatability issues.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e","title":"Creating a .kml file from a Google Earth project"},{"content":" Note: I have a sneaking suspicion that trying this in Earth Engine proper using JS will significantly improve the results. The same goal attempted in rgee will remain available below, and a hopefully better JS version will appear above this in the coming days.\nNote 2: JS version had the same issues and created more problems. Nevermind!\nRgee version Introduction Goal: create global maps showing Dryness Index and Evaporative Index in both 2012 and 2019, using rgee.\nThis was pretty tricky to get working. The primary challenge was visualizing the data in a way that was meaningful, and preventing extreme values from obfuscating the scale.\nScale values / min and max A major pain to get right. The values in the script below are still not correct and the product generated should not be used for any purpose other than general visualization. Google Earth Engine documentation provides estimated min and max values and scale, but using those results in seemingly useless visualizations. After trials, I found that the best visualization came from using max values of 4 for DI layers, and 2 for EI layers. Additionally, make sure to multiple all bands by 0.1 to account for scale.\nColor palette Another pinch point. At first, the map being dominated by extreme values seems like an issue that could be easily solved by using a more expansive color palette. In practice, this doesn\u0026rsquo;t work. Going from only three colors to over twenty just creates more range in the areas of the map where range actually exists, instead of creating it in the areas that are solidly either the min or the max.\nData statistics Interesting findings here that mostly reveal my own incompetence. Doing some light sniffing on the visualized values gives some very bizarre results: for both bands, the 50th percentile is 0. For EI, the 95th percentile is 0.662 and the 99th is 0.759. Similar values are present among both years and both DI and EI.\nScript # Load required libraries library(rgee) library(ggplot2) # Initialize rgee: see docs.mor-gan.com/posts/setting-up-rgee/#initializing ee_check() ee_install_upgrade() ee$Authenticate(auth_mode=\u0026#39;localhost\u0026#39;) ee$Initialize(project=\u0026#39;ee-pugbugdude\u0026#39;) # Define the years of interest years \u0026lt;- c(2012, 2019) # Function to load datasets for different years - continued with snippet below. load_dataset \u0026lt;- function(year) { ee$ImageCollection(\u0026#34;IDAHO_EPSCOR/TERRACLIMATE\u0026#34;)$ filter(ee$Filter$calendarRange(year, year, \u0026#34;year\u0026#34;))$ mean() } # Loads the dataset above for both defined years. dataset_2012 \u0026lt;- load_dataset(2012) dataset_2019 \u0026lt;- load_dataset(2019) # Function to select bands and scale properly # see developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE#bands # for scaling info. get_scaled_bands \u0026lt;- function(dataset) { list( pet = dataset$select(\u0026#39;pet\u0026#39;)$multiply(0.1), aet = dataset$select(\u0026#39;aet\u0026#39;)$multiply(0.1), pr = dataset$select(\u0026#39;pr\u0026#39;) ) } # Sets the bands for both years bands_2012 \u0026lt;- get_scaled_bands(dataset_2012) bands_2019 \u0026lt;- get_scaled_bands(dataset_2019) # Calculate indices # DI (Dryness Index) = PET / PR # EI (Evaporative Index) = AET / PR calculate_indices \u0026lt;- function(bands) { list( dryness_index = bands$pet$divide(bands$pr)$rename(\u0026#34;Dryness_Index\u0026#34;), evap_index = bands$aet$divide(bands$pr)$rename(\u0026#34;Evaporative_Index\u0026#34;) ) } # Calculates indices for both years indices_2012 \u0026lt;- calculate_indices(bands_2012) indices_2019 \u0026lt;- calculate_indices(bands_2019) # Sets the palette to use for mapping. index_palette \u0026lt;- c(\u0026#34;blue\u0026#34;, \u0026#34;cyan\u0026#34;, \u0026#34;green\u0026#34;, \u0026#34;yellow\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;red\u0026#34;, \u0026#34;darkred\u0026#34;) # Function to put layers on the map for both years and bands # Uses variables set above # Why: It\u0026#39;s easier to be able to edit the palette, min, and max values # for all layers at once, rather than having to keep track of several different lines. visualize_layer \u0026lt;- function(image, title, min, max) { Map$addLayer( image, list(min = min, max = max, palette = index_palette), title ) } # Set min and max values for visualization. # IMPORTANT: These are very, very finicky to figure out. The min and max listed at # developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE#bands # will result in a wonky, poorly visualized map. # The numbers used below are a best attempt effort that generates a product to be used purely for # visualization, not a particularly accurate one. I strongly encourage you to adjust them to see how the map changes. dryness_index_min \u0026lt;- 0 dryness_index_max \u0026lt;- 4 evap_index_min \u0026lt;- 0 evap_index_max \u0026lt;- 1.5 # Adds each of the layers to the map. # In RStudio, the map should open automatically in the viewer tab. # In other environments, the map should open in a browser tab. visualize_layer(indices_2012$dryness_index, \u0026#34;DI 2012\u0026#34;, dryness_index_min, dryness_index_max) visualize_layer(indices_2012$evap_index, \u0026#34;EI 2012\u0026#34;, evap_index_min, evap_index_max) # Add layers for 2019 visualize_layer(indices_2019$dryness_index, \u0026#34;DI 2019\u0026#34;, dryness_index_min, dryness_index_max) visualize_layer(indices_2019$evap_index, \u0026#34;EI 2019\u0026#34;, evap_index_min, evap_index_max) ","permalink":"https://docs.mor-gan.com/posts/mapping-di-and-ep-with-rgee/","summary":"\u003cp\u003e\u003cpicture\u003e\n  \u003csource srcset=\"/images/rgee_global.webp\" type=\"image/webp\"\u003e\n  \u003cimg decoding=\"async\" loading=\"lazy\" src=\"/images/rgee_global.png\"\u003e\n\u003c/picture\u003e\nNote: I have a sneaking suspicion that trying this in Earth Engine proper using JS will significantly improve the results. The same goal attempted in rgee will remain available below, and a hopefully better JS version will appear above this in the coming days.\u003c/p\u003e\n\u003cp\u003eNote 2: JS version had the same issues and created more problems. Nevermind!\u003c/p\u003e\n\u003ch2 id=\"rgee-version\"\u003eRgee version\u003c/h2\u003e\n\u003ch3 id=\"introduction\"\u003eIntroduction\u003c/h3\u003e\n\u003cp\u003eGoal: create global maps showing Dryness Index and Evaporative Index in both 2012 and 2019, using rgee.\u003c/p\u003e","title":"Mapping DI and EP with rgee"},{"content":"Introduction In general, exporting data to a .csv with rgee is pretty easy. The general gist of the process is:\nDefine the area or points you are interested in Filter data Convert the results to a list, and Export to a csv. Example Make sure to load and initialize rgee first!\n# Define an AOI over Kansas aoi \u0026lt;- ee$Geometry$Rectangle(c(-102.05, 36.99, -94.6, 40.0)) # Define sample points in the area points \u0026lt;- ee$FeatureCollection(c( ee$Feature(ee$Geometry$Point(-98.5795, 39.8283), list(label = \u0026#34;1\u0026#34;)), ee$Feature(ee$Geometry$Point(-97.5795, 38.8283), list(label = \u0026#34;2\u0026#34;)), ee$Feature(ee$Geometry$Point(-96.5795, 37.8283), list(label = \u0026#34;3\u0026#34;)) )) # Grab an image from Sentinal 2 and calculate NDVI s2_collection \u0026lt;- ee$ImageCollection(\u0026#34;COPERNICUS/S2\u0026#34;)$ filterDate(\u0026#39;2020-06-01\u0026#39;, \u0026#39;2020-06-30\u0026#39;)$ filterBounds(aoi)$ map(function(image) { ndvi \u0026lt;- image$normalizedDifference(c(\u0026#34;B8\u0026#34;, \u0026#34;B4\u0026#34;))$rename(\u0026#34;NDVI\u0026#34;) return(image$addBands(ndvi)) }) ndvi_image \u0026lt;- s2_collection$select(\u0026#34;NDVI\u0026#34;)$mean()$clip(aoi) # Grab NDVI values at the sample points ndvi_values \u0026lt;- ndvi_image$reduceRegions( collection = points, reducer = ee$Reducer$mean(), scale = 30 ) # Convert the result to a list and then to a data frame ndvi_list \u0026lt;- ndvi_values$getInfo()$features ndvi_df \u0026lt;- do.call(rbind, lapply(ndvi_list, function(x) data.frame( label = x$properties$label, NDVI = x$properties$mean, lon = x$geometry$coordinates[1], lat = x$geometry$coordinates[2] ))) # Save the data frame as a CSV write.csv(ndvi_df, \u0026#34;ndvi_values_hello.csv\u0026#34;, row.names = FALSE) ","permalink":"https://docs.mor-gan.com/posts/exporting-data-to-a-csv-with-rgee/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eIn general, exporting data to a .csv with rgee is pretty easy. The general gist of the process is:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDefine the area or points you are interested in\u003c/li\u003e\n\u003cli\u003eFilter data\u003c/li\u003e\n\u003cli\u003eConvert the results to a list, and\u003c/li\u003e\n\u003cli\u003eExport to a csv.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"example\"\u003eExample\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eMake sure to load and initialize rgee first!\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-R\" data-lang=\"R\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Define an AOI over Kansas\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaoi \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eGeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eRectangle\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e-102.05\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e36.99\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e-94.6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e40.0\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Define sample points in the area\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epoints \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eFeatureCollection\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eFeature\u003c/span\u003e(ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eGeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ePoint\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e-98.5795\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e39.8283\u003c/span\u003e), \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e)),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eFeature\u003c/span\u003e(ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eGeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ePoint\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e-97.5795\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e38.8283\u003c/span\u003e), \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e)),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eFeature\u003c/span\u003e(ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eGeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ePoint\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e-96.5795\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e37.8283\u003c/span\u003e), \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Grab an image from Sentinal 2 and calculate NDVI\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003es2_collection \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eImageCollection\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;COPERNICUS/S2\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efilterDate\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2020-06-01\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2020-06-30\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efilterBounds\u003c/span\u003e(aoi)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003emap\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e(image) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ndvi \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enormalizedDifference\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;B8\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;B4\u0026#34;\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003erename\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;NDVI\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e(image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eaddBands\u003c/span\u003e(ndvi))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  })\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003endvi_image \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e s2_collection\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eselect\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;NDVI\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emean\u003c/span\u003e()\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eclip\u003c/span\u003e(aoi)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Grab NDVI values at the sample points\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003endvi_values \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ndvi_image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ereduceRegions\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  collection \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e points,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  reducer \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eReducer\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emean\u003c/span\u003e(),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  scale \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e30\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Convert the result to a list and then to a data frame\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003endvi_list \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ndvi_values\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003egetInfo\u003c/span\u003e()\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003efeatures\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003endvi_df \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edo.call\u003c/span\u003e(rbind, \u003cspan style=\"color:#a6e22e\"\u003elapply\u003c/span\u003e(ndvi_list, \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e(x) \u003cspan style=\"color:#a6e22e\"\u003edata.frame\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e x\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eproperties\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003elabel,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  NDVI \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e x\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eproperties\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003emean,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  lon \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e x\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003egeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ecoordinates[1],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  lat \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e x\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003egeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ecoordinates[2]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Save the data frame as a CSV\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ewrite.csv\u003c/span\u003e(ndvi_df, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ndvi_values_hello.csv\u0026#34;\u003c/span\u003e, row.names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFALSE\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Exporting data to a CSV with rgee"},{"content":"Data types (link to method of gathering) MAT (Mean Annual Temperature) Average yearly temperature. MAP (Mean Annual Precipitation) Average yearly precipitation. GPP (Gross Primary Productivity) Total amount of energy captured by plants. Does not account for respiration losses. NPP (Net Primary Productivity) Amount of energy that remains after plants have used some of the captured energy for their own respiration. Actual amount of new biomass that is available for consumption by other critters. NPP = GPP - Respiration PET (Potential Evapotranspiration) Amount of water that would be evaporated and transpired by vegetation if there was sufficient water available. Atmospheric demand for water. AET, ET (Actual Evapotranspiration) - Actual amount of water that is evaporated from soil and transpired by vegetation. Less than or equal to PET. Depends on availability of water. DI (Dryness Index) PET / MAP EP (Evaporation Potential) 1 - (PET /MAP) Sites Data was gathered from multiple sites, sorted with a RegionName, SiteName, and Pit. It\u0026rsquo;s important that the Pit is unique.\nNote: Although the majority of data sources were the same, there are sites where alternate sources were used. See footnotes.\nRegionName SiteName Pit Calhoun R7 R7P2 Calhoun R2 R2P1 Calhoun R7 R7P1 Calhoun R8 R8P1 Calhoun R8 R8P2.5 Calhoun R8 R8P2 Calhoun R1 R1C2 Calhoun R1 R1C3 Calhoun R2 R2H1 Calhoun R7 R7H1 Calhoun R7 R7H2 Calhoun R8 R8H1 Calhoun R8 R8H2.5 Calhoun R8 R8H2 Luquillo1 ElVerde ElVerdeM Luquillo1 ElVerde ElVerdeR Luquillo1 ElVerde ElVerdeT Luquillo2 Icacos IcacosM Luquillo2 Icacos IcacosR Luquillo2 Icacos IcacosT Catalina3 MixedCon MC_M Catalina3 MixedCon MC_R Catalina3 MixedCon MC_T Catalina3 BigelowDesert B2D_M Catalina3 BigelowDesert B2D_R Catalina3 BigelowDesert B2D_T ReynoldsCr4 NorthBasalt NB_R ReynoldsCr4 NorthBasalt NB_T ReynoldsCr4 NorthLoess NL_T ReynoldsCr4 SWBasalt SWB_M ReynoldsCr4 SWBasalt SWB_T ReynoldsCr4 SWLoess SWL_T SouthernSierra5 SJER SJER_M SouthernSierra5 SJER SJER_R SouthernSierra5 SJER SJER_T DukeFarm DukeFarm DFPasture EKS Ottawa EKSAgri EKS Welda EKSNative EKS Welda EKSPostAg KNZ KNZ KNZNative KNZ KNZ KNZAgri KNZ KNZ KNZPostAg HAY HAY HAYNative HAY HAY HAYAgri HAY HAY HAYPostAg TRB TRB TRBNative TRB TRB TRBAgri TRB TRB TRBAgriIrrig TRB TRB TRBPostAg FRESCC CC1 CC1_2020 FRESCC CC2 CC2_2020 FRESCC CC2 CC2_2022 FRESCC CC3 CC3_2021 FRESCC CC3 CC3_2022 FRESCC CC4 CC4_2021 FRESCC CC5 CC5_2021 Konza GrassyToe GrToeN01B Konza WoodyToe WdToeN04D Konza GrassyBackslope GrBackslN01B Konza WoodyBackslope WdBackslN04D Konza GrassySummit GrSummN01B Konza WoodySummit WdSummN04D HJAndrews6 WS01 NF_Y_A HJAndrews6 WS01 SF_Y_A HJAndrews6 WS02 NF_O_A HJAndrews6 WS02 SF_O_A HJAndrews6 WS03 NF_O_A HJAndrews6 WS03 NF_Y_A HJAndrews6 WS03 SF_O_A HJAndrews6 WS03 SF_Y_A Alps Glacier Alps1 Alps GlacierRidge Alps2 Alps Limestone Alps3 Alps Gneiss Alps5 Alps Alluvial Alps6 NH ThompsonPasture NH_TP NH ThompsonForest NH_TF NH OrganicPasture NH_OP NH OrganicForest NH_OF SouthernSierra7 Providence PROV304_R SouthernSierra7 Providence PROV304_M SouthernSierra7 Providence PROV304_T RCEW RCEW_OC RCEW_OC RCEW RCEW_OJ RCEW_OJ RCEW RCEW_OS RCEW_OS RCEW RCEW_YC RCEW_YC RCEW RCEW_YJ RCEW_YJ RCEW RCEW_YS RCEW_YS Process MAT Gathered mainly from NCEI at NOAA.\nTurn on the \u0026ldquo;Annual Normals (2006-2020)\u0026rdquo; map layer, and disable the \u0026ldquo;Global Summary of the Year\u0026rdquo; layer. Put coords into floating search box, and find a station near enough to the site to be relevant. Click the wrench on \u0026ldquo;Annual Normals (2006-2020)\u0026rdquo;, and use the rectangle tool to make a box around the station, just enough to select it. Select the station in the menu that appears on the left side of the page, and add to cart. In the new tab, click \u0026ldquo;Show List\u0026rdquo; under the \u0026ldquo;Data Types\u0026rdquo; text field. Type, filter, and select both \u0026ldquo;Annual average temperature mean\u0026rdquo; and \u0026ldquo;Annual precipitation totals\u0026rdquo; In the downloaded .csv, precip is labeled as ANN-PRCP-NORMAL, and temperature is labeled as ANN-TAVG-NORMAL. MAP Gathered mainly from NCEI at NOAA.\nTurn on the \u0026ldquo;Annual Normals (2006-2020)\u0026rdquo; map layer, and disable the \u0026ldquo;Global Summary of the Year\u0026rdquo; layer. Put coords into floating search box, and find a station near enough to the site to be relevant. Click the wrench on \u0026ldquo;Annual Normals (2006-2020)\u0026rdquo;, and use the rectangle tool to make a box around the station, just enough to select it. Select the station in the menu that appears on the left side of the page, and add to cart. In the new tab, click \u0026ldquo;Show List\u0026rdquo; under the \u0026ldquo;Data Types\u0026rdquo; text field. Type, filter, and select both \u0026ldquo;Annual average temperature mean\u0026rdquo; and \u0026ldquo;Annual precipitation totals\u0026rdquo; In the downloaded .csv, precip is labeled as ANN-PRCP-NORMAL, and temperature is labeled as ANN-TAVG-NORMAL. NPP NPP data is gathered from AppEEARS.\nNavigate to Extract \u0026gt; Point, and make an account if you haven\u0026rsquo;t. Start a new request. Name the request, and put your coordinates in the text box on the right. Comma seperated, the text should look like ID, Category, Lat, Long. You can alternatively upload a .csv with the same formatting, useful for large pulls. Set the dates. For this process, I was pulling from Jan 1, 2006 - Dec 31, 2021. Scroll down to select layers to include in the sample. NPP is the first result. Make sure the data is yearly, not 8-day. Add other products if you wish, and submit the request. Depending on the size of the data requested, it can take up to a couple hours to process. PET PET data is gathered from AppEEARS.\nNavigate to Extract \u0026gt; Point, and make an account if you haven\u0026rsquo;t. Start a new request. Name the request, and put your coordinates in the text box on the right. Comma seperated, the text should look like ID, Category, Lat, Long. You can alternatively upload a .csv with the same formatting, useful for large pulls. Set the dates. For this process, I was pulling from Jan 1, 2006 - Dec 31, 2021. Scroll down to select layers to include in the sample. Search for \u0026ldquo;Evapo yearly\u0026rdquo; select the first option. PET is labeled \u0026ldquo;PET\u0026rdquo;, and AET is labeled \u0026ldquo;ET\u0026rdquo;. Depending on the size of the data requested, it can take up to a couple hours to process. AET, ET AET data is gathered from AppEEARS.\nNavigate to Extract \u0026gt; Point, and make an account if you haven\u0026rsquo;t. Start a new request. Name the request, and put your coordinates in the text box on the right. Comma seperated, the text should look like ID, Category, Lat, Long. You can alternatively upload a .csv with the same formatting, useful for large pulls. Set the dates. For this process, I was pulling from Jan 1, 2006 - Dec 31, 2021. Scroll down to select layers to include in the sample. Search for \u0026ldquo;Evapo yearly\u0026rdquo; select the first option. PET is labeled \u0026ldquo;PET\u0026rdquo;, and AET is labeled \u0026ldquo;ET\u0026rdquo;. Depending on the size of the data requested, it can take up to a couple hours to process. DI DI and EP are calculated with PET and MAP products. PET / MAP EP EP and DI are calculated with PET and MAP products. 1 - (PET / MAP) GPP GPP data is gathered from AppEEARS.\nNavigate to Extract \u0026gt; Point, and make an account if you haven\u0026rsquo;t.\nStart a new request.\nName the request, and put your coordinates in the text box on the right. Comma seperated, the text should look like ID, Category, Lat, Long.\nYou can alternatively upload a .csv with the same formatting, useful for large pulls. Set the dates. For this project, I was pulling from Jan 1, 2006 - Dec 31, 2021.\nScroll down to select layers to include in the sample.\nGPP is only available in 8-day, which creates an extremely obnoxious problem - I solved this problem with an R script\nIf you need to calculate yearly GPP for many different sites, the first script is intended for that purpose.\nIf you only need to calculate yearly GPP for one single site, then scroll down for instructions.\nInitial .csv setup Before you begin, we will need to edit the excel file that AppEEARS gives us. Keep only the needed columns: ID, Category, Latitude, Longitude, Date and GPP - Note that the actual GPP column is labeled something like \u0026ldquo;MOD17A2HGF_061_Gpp_500m\u0026rdquo; There are many extra columns that you will need to delete. Rename the GPP column to \u0026ldquo;GPP\u0026rdquo; Create a new column called \u0026ldquo;Year\u0026rdquo;. The goal is to have this column show the year in YYYY format for every sample. In the first cell (Should be E2 or F2), enter \u0026ldquo;=YEAR(D2)\u0026rdquo;, where D2 refers to your date column. Change the cell type to \u0026ldquo;General\u0026rdquo; - you should see a year in YYYY format. Extend this formula down to fill in the whole Year column. Copy the whole column, and then Edit \u0026gt; Paste Special\u0026hellip;, and select Values. This replaces the formula dependent cells with ones that show the year in plain text. The list of columns should now be ID, Category, Latitude, Longitude, Date, Year, GPP. In the script, \u0026ldquo;GPP all sites.csv\u0026rdquo; refers to the downloaded .csv - you will need to either rename your file or change this to change the call in the file to point to the correct location. library(dplyr) gpp_data \u0026lt;- read.csv(\u0026#34;GPP all sites.csv\u0026#34;) gpp_data \u0026lt;- gpp_data %\u0026gt;% filter(Year != 2005) yearly_gpp \u0026lt;- gpp_data %\u0026gt;% group_by(ID, Category, Year) %\u0026gt;% summarize(total_GPP = sum(GPP, na.rm = TRUE), .groups = \u0026#34;drop\u0026#34;) average_gpp \u0026lt;- yearly_gpp %\u0026gt;% group_by(ID, Category) %\u0026gt;% summarize(average_GPP = mean(total_GPP, na.rm = TRUE), .groups = \u0026#34;drop\u0026#34;) write.csv(average_gpp, \u0026#34;average gpp.csv\u0026#34;, row.names = FALSE) Precipitation and temperature data for El Verde pits were gathered from Luquillo LTER; \u0026ldquo;Field Station Air temperature from automatic sensor\u0026rdquo; and \u0026ldquo;Rainfall at El Verde Field Station\u0026rdquo;, from 2010-2023. MAT data is viewable and automatically averaged with the \u0026ldquo;Explore data\u0026rdquo; button, but MAP data needs to be downloaded, manually added and averaged.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nTemperature data from the El Verde site was used. Precipitation data was pulled from NCEI at NOAA.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPrecipitation and temperature data for MC and B2D pits were gathered from Oregon State University\u0026rsquo;s PRISM climate data base.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPrecipitation and temperature data for NorthBasalt and NorthLoess pits were gathered from Warming Alters Hydrologic Heterogeneity: Simulated Climate Sensitivity of Hydrology-Based Microrefugia in the Snow-to-Rain Transition Zone, Table 1. NL_T is associated with Aspen, and all other pits were associated with Low sage.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPrecipitation and temperature data were gathered from Hydroshare, from 2010-2018. Data is taken hourly, so it was summed and averaged across years. Data from 2018 was excluded from the precipitation average because it was erroneous. For temperature, TACTUAL was used in the average.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPrecipitation and temperature data for HJAndrews pits were gathered from Oregon State University.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPrecipitation and temperature data from Hydroshare, from 2008-2018. Data is taken hourly, so it was summed and averaged across years. For temperature, TACTUAL was used in the average.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://docs.mor-gan.com/posts/getting-data-from-appeears-and-noaa/","summary":"\u003ch2 id=\"data-types--link-to-method-of-gathering\"\u003eData types (link to method of gathering)\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#mat\"\u003eMAT (Mean Annual Temperature)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eAverage yearly temperature.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#map\"\u003eMAP (Mean Annual Precipitation)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eAverage yearly precipitation.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#gpp\"\u003eGPP (Gross Primary Productivity)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eTotal amount of energy captured by plants. Does not account for respiration losses.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#npp\"\u003eNPP (Net Primary Productivity)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eAmount of energy that remains after plants have used some of the captured energy for their own respiration. Actual amount of new biomass that is available for consumption by other critters. NPP = GPP - Respiration\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#pet\"\u003ePET (Potential Evapotranspiration)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eAmount of water that would be evaporated and transpired by vegetation if there was sufficient water available. Atmospheric demand for water.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#aet-et\"\u003eAET, ET (Actual Evapotranspiration)\u003c/a\u003e  - Actual amount of water that is evaporated from soil and transpired by vegetation. Less than or equal to PET. Depends on availability of water.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#di\"\u003eDI (Dryness Index)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003ePET / MAP\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#ep\"\u003eEP (Evaporation Potential)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e1 - (PET /MAP)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"sites\"\u003eSites\u003c/h2\u003e\n\u003cp\u003eData was gathered from multiple sites, sorted with a RegionName, SiteName, and Pit. It\u0026rsquo;s important that the Pit is unique.\u003c/p\u003e","title":"Getting data from AppEEARS and NOAA"},{"content":"Introduction Raw data often needs to be transformed in order to do anything useful with it. Typically, transforming variables in GEE involves manipulating raw bands of imagery to create products like NDVI and EVI, or performing math operations with multiple datasets.\nDividing EVI by Precipitation In this example, EVI is being divided by precipitation data for Kansas, and the result is mapped.\nLoad and initialize rgee first!\nlibrary(rgee) ee_Initialize() # Define an area of interest (AOI) over Kansas aoi \u0026lt;- ee$Geometry$Rectangle(c(-102.05, 36.99, -94.6, 40.0)) # Load the Sentinel-2 image collection and calculate EVI s2_collection \u0026lt;- ee$ImageCollection(\u0026#34;COPERNICUS/S2\u0026#34;)$ filterDate(\u0026#39;2020-06-01\u0026#39;, \u0026#39;2020-08-31\u0026#39;)$ filterBounds(aoi)$ map(function(image) { evi \u0026lt;- image$expression( \u0026#39;2.5 * ((NIR - RED) / (NIR + 6 * RED - 7.5 * BLUE + 1))\u0026#39;, list(\u0026#39;NIR\u0026#39; = image$select(\u0026#34;B8\u0026#34;), \u0026#39;RED\u0026#39; = image$select(\u0026#34;B4\u0026#34;), \u0026#39;BLUE\u0026#39; = image$select(\u0026#34;B2\u0026#34;)) )$rename(\u0026#34;EVI\u0026#34;) return(image$addBands(evi)) }) evi_image \u0026lt;- s2_collection$select(\u0026#34;EVI\u0026#34;)$mean()$clip(aoi) # Visualize EVI to ensure it\u0026#39;s calculated correctly evi_viz \u0026lt;- list( min = -1, max = 1, palette = c(\u0026#34;brown\u0026#34;, \u0026#34;yellow\u0026#34;, \u0026#34;green\u0026#34;) ) Map$setCenter(-98.35, 38.5, 6) Map$addLayer(evi_image, evi_viz, \u0026#34;EVI\u0026#34;) # Load the TerraClimate PPT (precipitation) dataset ppt_dataset \u0026lt;- ee$ImageCollection(\u0026#34;IDAHO_EPSCOR/TERRACLIMATE\u0026#34;)$ filterDate(\u0026#39;2020-01-01\u0026#39;, \u0026#39;2020-12-31\u0026#39;)$ select(\u0026#34;pr\u0026#34;)$ mean()$ clip(aoi) # Visualize PPT to ensure it\u0026#39;s loaded correctly ppt_viz \u0026lt;- list( min = 0, max = 2000, palette = c(\u0026#34;blue\u0026#34;, \u0026#34;white\u0026#34;, \u0026#34;green\u0026#34;) ) Map$addLayer(ppt_dataset, ppt_viz, \u0026#34;Precipitation\u0026#34;) # Ensure the datasets align perfectly for each pixel evi_resampled \u0026lt;- evi_image$reproject(crs = ppt_dataset$projection(), scale = 1000) ppt_resampled \u0026lt;- ppt_dataset$reproject(crs = evi_image$projection(), scale = 1000) # Divide EVI by PPT evi_ppt_ratio \u0026lt;- evi_resampled$divide(ppt_resampled) # Define visualization parameters for the ratio evi_ppt_viz \u0026lt;- list( min = 0, max = 0.1, palette = c(\u0026#34;blue\u0026#34;, \u0026#34;white\u0026#34;, \u0026#34;red\u0026#34;) ) # Add the EVI/PPT ratio layer Map$addLayer(evi_ppt_ratio, evi_ppt_viz, \u0026#34;EVI/PPT Ratio\u0026#34;) Breakdown Define the AOI, the state of Kansas. aoi \u0026lt;- ee$Geometry$Rectangle(c(-102.05, 36.99, -94.6, 40.0)) Load and Filter Sentinel-2 Data Next, we load the Sentinel-2 image collection, filter it for the summer months (June to August 2020), and calculate EVI for each image. EVI values are then averaged and clipped only to our AOI.\ns2_collection \u0026lt;- ee$ImageCollection(\u0026#34;COPERNICUS/S2\u0026#34;)$ filterDate(\u0026#39;2020-06-01\u0026#39;, \u0026#39;2020-08-31\u0026#39;)$ filterBounds(aoi)$ map(function(image) { evi \u0026lt;- image$expression( \u0026#39;2.5 * ((NIR - RED) / (NIR + 6 * RED - 7.5 * BLUE + 1))\u0026#39;, list(\u0026#39;NIR\u0026#39; = image$select(\u0026#34;B8\u0026#34;), \u0026#39;RED\u0026#39; = image$select(\u0026#34;B4\u0026#34;), \u0026#39;BLUE\u0026#39; = image$select(\u0026#34;B2\u0026#34;)) )$rename(\u0026#34;EVI\u0026#34;) return(image$addBands(evi)) }) evi_image \u0026lt;- s2_collection$select(\u0026#34;EVI\u0026#34;)$mean()$clip(aoi) First mapping of EVI This is to make sure the current values are correct and being visualized correctly. I had a lot of trouble with this example in particular, so I am redundantly checking work as we go.\nevi_viz \u0026lt;- list( min = -1, max = 1, palette = c(\u0026#34;brown\u0026#34;, \u0026#34;yellow\u0026#34;, \u0026#34;green\u0026#34;) ) Map$setCenter(-98.35, 38.5, 6) Map$addLayer(evi_image, evi_viz, \u0026#34;EVI\u0026#34;) Loading precip data We load precip data from TerraClimate, filter it for the year 2020, average values, and clip them.\nppt_dataset \u0026lt;- ee$ImageCollection(\u0026#34;IDAHO_EPSCOR/TERRACLIMATE\u0026#34;)$ filterDate(\u0026#39;2020-01-01\u0026#39;, \u0026#39;2020-12-31\u0026#39;)$ select(\u0026#34;pr\u0026#34;)$ mean()$ clip(aoi) Visualize PPT to make sure it\u0026rsquo;s correct Again, I am visualizing the precipitation data to make sure it looks correct.\nppt_viz \u0026lt;- list( min = 0, max = 2000, palette = c(\u0026#34;blue\u0026#34;, \u0026#34;white\u0026#34;, \u0026#34;green\u0026#34;) ) Map$addLayer(ppt_dataset, ppt_viz, \u0026#34;Precipitation\u0026#34;) Make sure data is aligned Before actually performing any operations on the data, making sure that both datasets are aligned correctly is important. Here I\u0026rsquo;m reprojecting both sets to the same scale and resolution.\nevi_resampled \u0026lt;- evi_image$reproject(crs = ppt_dataset$projection(), scale = 1000) ppt_resampled \u0026lt;- ppt_dataset$reproject(crs = evi_image$projection(), scale = 1000) Transform the data Dividing the EVI by the precip to calculate the ratio.\nevi_ppt_ratio \u0026lt;- evi_resampled$divide(ppt_resampled) Define viz params for mapping the new ratio evi_ppt_viz \u0026lt;- list( min = 0, max = 0.1, palette = c(\u0026#34;blue\u0026#34;, \u0026#34;white\u0026#34;, \u0026#34;red\u0026#34;) ) Map$addLayer(evi_ppt_ratio, evi_ppt_viz, \u0026#34;EVI/PPT Ratio\u0026#34;) ","permalink":"https://docs.mor-gan.com/posts/making-maps-of-variables-with-rgee/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eRaw data often needs to be transformed in order to do anything useful with it. Typically, transforming variables in GEE involves manipulating raw bands of imagery to create products like NDVI and EVI, or performing math operations with multiple datasets.\u003c/p\u003e\n\u003ch3 id=\"dividing-evi-by-precipitation\"\u003eDividing EVI by Precipitation\u003c/h3\u003e\n\u003cp\u003eIn this example, EVI is being divided by precipitation data for Kansas, and the result is mapped.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eLoad and initialize rgee first!\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-R\" data-lang=\"R\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(rgee)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eee_Initialize\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Define an area of interest (AOI) over Kansas\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaoi \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eGeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eRectangle\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e-102.05\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e36.99\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e-94.6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e40.0\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Load the Sentinel-2 image collection and calculate EVI\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003es2_collection \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eImageCollection\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;COPERNICUS/S2\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efilterDate\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2020-06-01\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2020-08-31\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efilterBounds\u003c/span\u003e(aoi)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003emap\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e(image) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    evi \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eexpression\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2.5 * ((NIR - RED) / (NIR + 6 * RED - 7.5 * BLUE + 1))\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;NIR\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eselect\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;B8\u0026#34;\u003c/span\u003e), \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;RED\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eselect\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;B4\u0026#34;\u003c/span\u003e), \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;BLUE\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eselect\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;B2\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    )\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003erename\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;EVI\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e(image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eaddBands\u003c/span\u003e(evi))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  })\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eevi_image \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e s2_collection\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eselect\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;EVI\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emean\u003c/span\u003e()\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eclip\u003c/span\u003e(aoi)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Visualize EVI to ensure it\u0026#39;s calculated correctly\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eevi_viz \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  min \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e-1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  max \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  palette \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;brown\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;yellow\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;green\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMap\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esetCenter\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e-98.35\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e38.5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMap\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eaddLayer\u003c/span\u003e(evi_image, evi_viz, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;EVI\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Load the TerraClimate PPT (precipitation) dataset\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eppt_dataset \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eImageCollection\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;IDAHO_EPSCOR/TERRACLIMATE\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efilterDate\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2020-01-01\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2020-12-31\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eselect\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pr\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003emean\u003c/span\u003e()\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eclip\u003c/span\u003e(aoi)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Visualize PPT to ensure it\u0026#39;s loaded correctly\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eppt_viz \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  min \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  max \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2000\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  palette \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;blue\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;white\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;green\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMap\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eaddLayer\u003c/span\u003e(ppt_dataset, ppt_viz, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Precipitation\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Ensure the datasets align perfectly for each pixel\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eevi_resampled \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e evi_image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ereproject\u003c/span\u003e(crs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ppt_dataset\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eprojection\u003c/span\u003e(), scale \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1000\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eppt_resampled \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ppt_dataset\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ereproject\u003c/span\u003e(crs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e evi_image\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eprojection\u003c/span\u003e(), scale \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1000\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Divide EVI by PPT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eevi_ppt_ratio \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e evi_resampled\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edivide\u003c/span\u003e(ppt_resampled)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Define visualization parameters for the ratio\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eevi_ppt_viz \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  min \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  max \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  palette \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;blue\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;white\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;red\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Add the EVI/PPT ratio layer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMap\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eaddLayer\u003c/span\u003e(evi_ppt_ratio, evi_ppt_viz, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;EVI/PPT Ratio\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"breakdown\"\u003eBreakdown\u003c/h3\u003e\n\u003ch4 id=\"define-the-aoi-the-state-of-kansas-dot\"\u003eDefine the AOI, the state of Kansas.\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-R\" data-lang=\"R\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaoi \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eGeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eRectangle\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e-102.05\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e36.99\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e-94.6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e40.0\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"load-and-filter-sentinel-2-data\"\u003eLoad and Filter Sentinel-2 Data\u003c/h4\u003e\n\u003cp\u003eNext, we load the Sentinel-2 image collection, filter it for the summer months (June to August 2020), and calculate EVI for each image. EVI values are then averaged and clipped only to our AOI.\u003c/p\u003e","title":"Making maps of variables with rgee"},{"content":"Introduction From the rgee github page: \u0026ldquo;rgee is an R binding package for calling Google Earth Engine API from within R. Various functions are implemented to simplify the connection with the R spatial ecosystem.\u0026rdquo;\nThis guide assumes use of RStudio on a Mac, but I personally use Emacs with ESS and found it to work wonderfully. Any Unix based system should work similarly. Windows should theoretically work by following the below, but more work might be required and I haven\u0026rsquo;t tested it.\nPrerequisites R and RStudio (or other IDE) Google Earth Engine account. Create a GEE project to work in. A healthy mindset 😊 Installation Install rgee, geojsonio and miniconda.\ninstall.packages(\u0026#39;rgee\u0026#39;) install.packages(\u0026#39;reticulate\u0026#39;) install.packages(\u0026#39;geojsonio\u0026#39;) reticulate::install_miniconda() Setup Load the packages.\nlibrary(rgee) library(geojsonio) library(reticulate) Install dependencies and double check to make sure everything is up to date.\nrgee::ee_install() rgee::ee_install_upgrade() By this point, you should be ready to initialize rgee. To double check everything is ready, run a\nee_check() to make sure. Note: If the previous command complains about an argument being of length zero, it should be fine to ignore it and carry on.\nInitializing If you haven\u0026rsquo;t already, you will need to create a new project to work in. This process is semi annoying if you haven\u0026rsquo;t already done it before, full disclaimer.\nNavigate over to the GEE code editor and click on your profile picture in the top right. Click \u0026ldquo;Register a new Cloud Project\u0026rdquo;. Assuming this is correct, click \u0026ldquo;Register a Noncommercial or Commercial project\u0026rdquo; and then select \u0026ldquo;Unpaid usage\u0026rdquo;. Select the relevent project type in the dropdown menu.\nOn the next screen, choose \u0026ldquo;Create a new Google Cloud Project\u0026rdquo;. You can leave the Organization field blank, but you will need to at the least choose a project ID. I usually name my projects with the ee-username-rgee-#, where username is my username and # is a number. Note that creating the project can take a while. Don\u0026rsquo;t refresh the page, as you will be forced to go through the above process again.\nOnce you\u0026rsquo;ve confirmed your project\u0026rsquo;s information, you will be redirected to the GEE online code editor, where you can close the tab.\nMoving back into the IDE, we can now initialize rgee.\nee_Initialize() This should launch a page in your web browser where you can log in and select the project you created to link to rgee. Make sure to choose \u0026ldquo;Select an existing project\u0026rdquo; and select it.\nIf that didn\u0026rsquo;t work, or threw you an error, don\u0026rsquo;t panic. I had enormous amounts of trouble getting rgee to initialize properly. If this is the case for you, you can instead run the below two commands, which does the same thing.\nNote that you will need to replace the project name with your own.\nee$Authenticate(auth_mode=\u0026#39;localhost\u0026#39;) ee$Initialize(project=\u0026#39;YOUR-PROJECT-NAME\u0026#39;) Optionally, check your connectivity to GEE to see if everything is setup correctly.\nee$String(\u0026#39;Hello from the Earth Engine servers!\u0026#39;)$getInfo() If one of those methods worked, pop the champagne.\nAt the start of every new R session where you want to use rgee, you will need to load and then initialize the package in order to use it.\nThis should look something like this\nlibrary(rgee) ee$Authenticate(auth_mode=\u0026#39;localhost\u0026#39;) ee$Initialize(project=\u0026#39;YOUR-PROJECT-NAME\u0026#39;) Remember to change the project name to the one you created earlier.\nExamples Surface water occurrence In this example, rgee is used to visualize global surface water occurrence using the JRC Global Surface Water dataset.\nLoad and initialize rgee first!\n# Loads the dataset from JRC gsw \u0026lt;- ee$Image(\u0026#34;JRC/GSW1_1/GlobalSurfaceWater\u0026#34;) occurrence \u0026lt;- gsw$select(\u0026#34;occurrence\u0026#34;) # Defines params to show surface water VIS_OCCURRENCE \u0026lt;- list( min = 0, max = 100, palette = c(\u0026#34;red\u0026#34;, \u0026#34;blue\u0026#34;) ) # Makes a mask with said params VIS_WATER_MASK \u0026lt;- list( palette = c(\u0026#34;white\u0026#34;, \u0026#34;black\u0026#34;) ) # Creates another mask that only shows areas w/ 90% water occurance water_mask \u0026lt;- occurrence$gt(90)$selfMask() # Sets the center of the map to Douglas County Map$setCenter(-95.3, 38.91, 11) # Adds both masks to the map Map$addLayer(occurrence$updateMask(occurrence$divide(100)), VIS_OCCURRENCE, \u0026#34;Water Occurrence (1984-2018)\u0026#34;) + Map$addLayer(water_mask, VIS_WATER_MASK, \u0026#34;90% occurrence\u0026#34;, FALSE) {% endhighlight %} May 28th 2019 Tornado In this example, rgee is used to view the damage path from the 2019 EF4 tornado that touched down in central Douglas County.\nLoad and initialize rgee first!\n# Defines an area around Douglas County. aoi \u0026lt;- ee$Geometry$Rectangle(c(-95.3, 38.85, -95.22, 38.91)) # Defines the dates we are interested in. start_date \u0026lt;- \u0026#39;2019-05-28\u0026#39; end_date \u0026lt;- \u0026#39;2019-06-01\u0026#39; pre_event_date \u0026lt;- \u0026#39;2019-05-20\u0026#39; # Load Sentinel-2 data for said dates. s2_collection \u0026lt;- ee$ImageCollection(\u0026#39;COPERNICUS/S2\u0026#39;)$ filterDate(start_date, end_date)$ filterBounds(aoi) # Get the least cloudy image from the post-event period. post_event_image \u0026lt;- s2_collection$sort(\u0026#39;CLOUDY_PIXEL_PERCENTAGE\u0026#39;)$first() # Define params for said image. viz_params \u0026lt;- list( bands = c(\u0026#39;B4\u0026#39;, \u0026#39;B3\u0026#39;, \u0026#39;B2\u0026#39;), min = 0, max = 3000, gamma = 1.4 ) # Add the post-event image to the map. Map$centerObject(aoi, 12) # Zoom in to level 12 for better detail Map$addLayer(post_even t_image, viz_params, \u0026#39;Post-Event Sentinel-2 Image\u0026#39;) # Load pre-event data for comparison. pre_event_image \u0026lt;- ee$ImageCollection(\u0026#39;COPERNICUS/S2\u0026#39;)$ filterDate(pre_event_date, start_date)$ filterBounds(aoi)$ sort(\u0026#39;CLOUDY_PIXEL_PERCENTAGE\u0026#39;)$first() # Calculate NDVI for pre and post tornado. pre_ndvi \u0026lt;- pre_event_image$normalizedDifference(c(\u0026#39;B8\u0026#39;, \u0026#39;B4\u0026#39;)) post_ndvi \u0026lt;- post_event_image$normalizedDifference(c(\u0026#39;B8\u0026#39;, \u0026#39;B4\u0026#39;)) # Find difference. ndvi_diff \u0026lt;- post_ndvi$subtract(pre_ndvi) # Define params for NDVI difference. ndvi_viz_params \u0026lt;- list(min = -0.5, max = 0.5, palette = c(\u0026#39;red\u0026#39;, \u0026#39;yellow\u0026#39;, \u0026#39;green\u0026#39;)) # Add NDVI diff. layer to map! Map$addLayer(ndvi_diff, ndvi_viz_params, \u0026#39;NDVI Difference\u0026#39;) {% endhighlight %} ","permalink":"https://docs.mor-gan.com/posts/setting-up-rgee/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eFrom the \u003ca href=\"https://github.com/r-spatial/rgee\"\u003ergee github page\u003c/a\u003e: \u0026ldquo;rgee is an R binding package for calling Google Earth Engine API from within R. Various functions are implemented to simplify the connection with the R spatial ecosystem.\u0026rdquo;\u003c/p\u003e\n\u003cp\u003eThis guide assumes use of RStudio on a Mac, but I personally use Emacs with ESS and found it to work wonderfully. Any Unix based system should work similarly. Windows should theoretically work by following the below, but more work might be required and I haven\u0026rsquo;t tested it.\u003c/p\u003e","title":"Setting up rgee"},{"content":"Introduction Google Earth Engine provides access to a bunch of geospatial datasets including satellite imagery, climate data and land cover classifications. These datasets, known as variables, are used to perform geospatial analyses.\nCalling variables Load and initialize rgee first!\nDefine an area that you want to visualize. The easiest way of doing this is to define a rectangle with coordinates.\naoi \u0026lt;- ee$Geometry$Rectangle(c(-120.4, 34.5, -119.4, 35.5)) In this example, I\u0026rsquo;ll use the MODIS land cover datasets.\nlandcover \u0026lt;- ee$ImageCollection(\u0026#34;MODIS/061/MCD12Q1\u0026#34;)$first()$select(\u0026#34;LC_Type1\u0026#34;) Set some visualization parameters to control how the data is displayed.\nlandcover_viz \u0026lt;- list( min = 1, max = 17, palette = c(\u0026#34;05450a\u0026#34;, \u0026#34;086a10\u0026#34;, \u0026#34;54a708\u0026#34;, \u0026#34;78d203\u0026#34;, \u0026#34;009900\u0026#34;, \u0026#34;c6b044\u0026#34;, \u0026#34;dcd159\u0026#34;, \u0026#34;dade48\u0026#34;, \u0026#34;fbff13\u0026#34;, \u0026#34;b6ff05\u0026#34;, \u0026#34;27ff87\u0026#34;, \u0026#34;c24f44\u0026#34;, \u0026#34;a5a5a5\u0026#34;, \u0026#34;ff6d4c\u0026#34;, \u0026#34;69fff8\u0026#34;, \u0026#34;f9ffa4\u0026#34;, \u0026#34;1c0dff\u0026#34;) ) Center the map on the area we are interested in, and add in the land cover layer using the parameters we defined above.\nMap$centerObject(aoi,8) Map$addLayer(landcover, landcover_viz, \u0026#34;Land Cover :)\u0026#34;) ","permalink":"https://docs.mor-gan.com/posts/using-variables-in-rgee/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eGoogle Earth Engine provides access to a bunch of geospatial datasets including satellite imagery, climate data and land cover classifications. These datasets, known as variables, are used to perform geospatial analyses.\u003c/p\u003e\n\u003ch2 id=\"calling-variables\"\u003eCalling variables\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eLoad and initialize rgee first!\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eDefine an area that you want to visualize. The easiest way of doing this is to define a rectangle with coordinates.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-R\" data-lang=\"R\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaoi \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e ee\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eGeometry\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eRectangle\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e-120.4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e34.5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e-119.4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e35.5\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn this example, I\u0026rsquo;ll use the MODIS land cover datasets.\u003c/p\u003e","title":"Using variables in rgee"}]