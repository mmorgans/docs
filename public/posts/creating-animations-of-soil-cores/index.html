<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Creating animations of soil cores out of CT scans | morgan docs</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction Goal: To create animations of soil cores spinning from .vol files obtained from the Pacific Northwest National Laboratory.
We&rsquo;re getting our files from the Environmental Molecular Sciences Laboratory at the Pacific Northwest National Laboratory, who have scanned the soil cores with a Nikon XTH CT scanner.
Requirements .vol files from a CT scanner At least 16gb of memory Ideally more. Both Fiji and Dragonfly attempt to load the entire file into memory; the downloaded .">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/creating-animations-of-soil-cores/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/creating-animations-of-soil-cores/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="morgan docs (Alt + H)">morgan docs</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/search/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Creating animations of soil cores out of CT scans
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h1>
    <div class="post-meta">10 min&nbsp;|&nbsp;<a href="https://github.com/mmorgans/docs/tree/main/content/posts/creating-animations-of-soil-cores.md" rel="noopener noreferrer" target="_blank">suggest changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#requirements" aria-label="Requirements">Requirements</a></li>
                <li>
                    <a href="#tl-dr" aria-label="TL;DR">TL;DR</a></li>
                <li>
                    <a href="#getting-dot-vol-files-from-emsl-data-portal" aria-label="Getting .vol files from EMSL data portal">Getting .vol files from EMSL data portal</a><ul>
                        
                <li>
                    <a href="#selecting-cores" aria-label="Selecting cores">Selecting cores</a></li>
                <li>
                    <a href="#downloading-cores" aria-label="Downloading cores">Downloading cores</a></li></ul>
                </li>
                <li>
                    <a href="#initial-dot-vol-work-in-fiji" aria-label="Initial .vol work in Fiji">Initial .vol work in Fiji</a></li>
                <li>
                    <a href="#working-in-dragonfly" aria-label="Working in Dragonfly">Working in Dragonfly</a><ul>
                        
                <li>
                    <a href="#loading-and-masking" aria-label="Loading &amp; masking">Loading &amp; masking</a></li>
                <li>
                    <a href="#animating" aria-label="Animating">Animating</a></li></ul>
                </li>
                <li>
                    <a href="#working-with-dot-avi-video-files-dot" aria-label="Working with .avi video files.">Working with .avi video files.</a></li>
                <li>
                    <a href="#ideas-maybe" aria-label="Ideas maybe">Ideas maybe</a></li>
                <li>
                    <a href="#gifs" aria-label="GIFS:">GIFS:</a></li>
                <li>
                    <a href="#soil-cores" aria-label="Soil cores">Soil cores</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>Goal: To create animations of soil cores spinning from .vol files obtained from the Pacific Northwest National Laboratory.</p>
<p>We&rsquo;re getting our files from the Environmental Molecular Sciences Laboratory at the Pacific Northwest National Laboratory, who have scanned the soil cores with a Nikon XTH CT scanner.</p>
<h2 id="requirements">Requirements<a hidden class="anchor" aria-hidden="true" href="#requirements">#</a></h2>
<ul>
<li>.vol files from a CT scanner</li>
<li>At least 16gb of memory
<ul>
<li><a href="https://downloadmoreram.com/">Ideally more</a>. Both Fiji and Dragonfly attempt to load the entire file into memory; the downloaded .vol is almost 40gb.</li>
</ul>
</li>
<li><a href="https://dragonfly.comet.tech/">Dragonfly from Comet Software</a>. You&rsquo;ll need a license: <a href="https://www.theobjects.com/dragonfly/get-trial-version-request-comet.php">30 day free trials</a> are easily accessible, and <a href="https://dragonfly.comet.tech/en/non-commercial-licensing">non commercial licenses are available</a>.</li>
<li><a href="https://fiji.sc/">Fiji</a> or ImageJ, but use Fiji.</li>
<li>A windows or Linux machine to run Dragonfly on; everything but that can be done on Mac</li>
</ul>
<h2 id="tl-dr">TL;DR<a hidden class="anchor" aria-hidden="true" href="#tl-dr">#</a></h2>
<ul>
<li>Download .vol files from <a href="https://sc-data.emsl.pnnl.gov/#state=32f73ab7-1755-4bad-8f02-a5640adf3a1a&amp;session_state=0f3eb580-fa1b-48b2-aed4-6eefcad788f9&amp;code=6f48e754-f383-442b-884b-f7222be36fbe.0f3eb580-fa1b-48b2-aed4-6eefcad788f9.21cf84f6-6ada-4d20-8b12-72f0a3e0bce3">EMSL Data portal</a></li>
<li>Import the files into Fiji as raw data, 2000x2000x2000
<ul>
<li>Convert to 8-bit, save as .tiff</li>
</ul>
</li>
<li>Open the .tiff in Dragonfly, crop to slices 250-1800
<ul>
<li>Make a cylindrical mask to crop the garbage off the core</li>
<li>Use movie maker to make a rotating movie, export to .avi</li>
</ul>
</li>
<li>Use Handbrake or similar to convert to mp4</li>
<li>Use Final Cut Pro or similar to crop to square</li>
<li>Use Gifski to convert to reasonably sized gif</li>
</ul>
<h2 id="getting-dot-vol-files-from-emsl-data-portal">Getting .vol files from EMSL data portal<a hidden class="anchor" aria-hidden="true" href="#getting-dot-vol-files-from-emsl-data-portal">#</a></h2>
<h3 id="selecting-cores">Selecting cores<a hidden class="anchor" aria-hidden="true" href="#selecting-cores">#</a></h3>
<p>To start, we need to get the CT scan files from EMSL, provided as .vol files.</p>
<ul>
<li>Navigate to the <a href="https://sc-data.emsl.pnnl.gov/#state=32f73ab7-1755-4bad-8f02-a5640adf3a1a&amp;session_state=0f3eb580-fa1b-48b2-aed4-6eefcad788f9&amp;code=6f48e754-f383-442b-884b-f7222be36fbe.0f3eb580-fa1b-48b2-aed4-6eefcad788f9.21cf84f6-6ada-4d20-8b12-72f0a3e0bce3">EMSL data portal</a>, and login.</li>
<li>On the left hand side of the screen, open the &ldquo;Project&rdquo; drawer and scroll down to the &ldquo;Principle Investigator&rdquo; field.</li>
<li>Enter the first few characters of a name, and then check the cooresponding box.</li>
<li>The main panel should update with the relevant project.</li>
<li>Scroll down to the &ldquo;Select Datasets&rdquo; button, and click it.</li>
</ul>
<p>You should now see a list of the datasets associated with that project. In this example, we&rsquo;re looking for individually numbered soil cores, but you will note that none of the data are labeled.</p>
<p>If you have a specific core number in mind, the only way to locate it is by looking inside of every single dataset by clicking the &ldquo;DOI&rdquo; button next to the Upload ID. You can then see the individual file names, which include the soil core number. If you decide to embark on a search to find a soil core, I recommend sorting by Instrument to only see XCT data, and then sort by file size. You are looking for datasets that are 29.8GB. Only view 10 datasets per page, as when you exit the DOI file viewer the entire webpage snaps to the top; it&rsquo;s easier to keep track of where you are when there are only 10 items.</p>
<p>Once you find the core you want, note the Upload ID. To search for an ID you already know, set Items per page to All, and use cmd + f.</p>
<p>Some known core ID&rsquo;s:</p>
<table>
<thead>
<tr>
<th>Core #</th>
<th>Bottom</th>
<th>Top</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>3132984</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>3134562</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>3135086</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>3135290</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>3049610</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>3133330</td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>3051409</td>
<td>3051495</td>
</tr>
<tr>
<td>15</td>
<td>3010819</td>
<td>3010713</td>
</tr>
<tr>
<td>16</td>
<td>3011663</td>
<td>3013268</td>
</tr>
<tr>
<td>20</td>
<td>3010658</td>
<td>3010660</td>
</tr>
</tbody>
</table>
<p>Some notes:</p>
<ul>
<li>Each core is 30cm tall, and the bottom 10cm and top 10cm were scanned.</li>
<li>Core height</li>
<li>2000 slices, how much is each slice</li>
<li>Some cores (Listed above: 1 &amp; 6) are difficult to use because they were sampled on a hill or something and its like just dirt and air</li>
</ul>
<h3 id="downloading-cores">Downloading cores<a hidden class="anchor" aria-hidden="true" href="#downloading-cores">#</a></h3>
<p>Add each dataset to your cart by checking the box next to it. To download the cores, you will need to set up and use Globus I realllly do not want to detail how to do that</p>
<p>Once EMSL prepares the files, you will see a link to go to the created guest collection. Open it, and navigate to your endpoint (computer) on the pane without the .tar in it. Go to the folder where you want the files to be downloaded to. Once there, select the tar on the other pane, hit &ldquo;Transfer or Sync to&hellip;&rdquo; in the middle, and then click start above the pane.</p>
<p>Globus will start transferring the file. You should get an email when its done. For reference, a 96GB transfer took a little over three and a half hours.</p>
<h2 id="initial-dot-vol-work-in-fiji">Initial .vol work in Fiji<a hidden class="anchor" aria-hidden="true" href="#initial-dot-vol-work-in-fiji">#</a></h2>
<p>Unzip the tarball, and navigate through the mess of folders inside to get to the .vol files (each should be around 30GB). I recommend moving the .vols into their own folder, separate from the tarball&rsquo;s filesystem, because it&rsquo;s obnoxious to have to go 30 directories deep to get to them.</p>
<p>Notes:</p>
<ul>
<li>Each .vol has a corresponding .vgi that contains metadata about the .vol. Open it in a text editor if you want to know more.</li>
<li>There are a number of other derived products in the tar, namely still images of the core and csv files with data (notably porosity).</li>
</ul>
<p>Each .vol contains 2000 images, each of which is 2000x2000 pixels, totalling <strong>8 billion voxels</strong>, each of which is represented as a 32-bit floating-point number and saved in an uncompressed file. This makes the raw files wildly impractical to work with, hence the use of Fiji. The goal is to convert each file to 8-bit and save it as a .tiff, both of which should drastically reduce the size while losing no useable data.</p>
<p>Open Fiji, and use File &gt; Import &gt; Raw&hellip; to open the .vol.</p>
<ul>
<li>Image type: 32-bit Real</li>
<li>Width: 2000</li>
<li>Height: 2000</li>
<li>Offset: 0</li>
<li>Number of images: 2000</li>
<li>Gap: 0</li>
</ul>
<p>Check Little-endian byte order and Use virtual stack. Virtual stacks load the images without fully committing them to memory, making it possible to view datasets that are larger in size than the amount of memory you have. <strong>If you don&rsquo;t have at least 40GB of memory and don&rsquo;t use virtual stacks, Fiji will crash your system attempting to load the file.</strong></p>
<p>Fiji will open the file, and you should be able to scroll through the slices of the core, or use the scroll bar at the bottom of the window containing the core.</p>
<p>To convert the file to 8-bit, use Image &gt; Type &gt; 8-bit. This will take time: you should be able to see Fiji converting images by the hundreds on the main toolbar.</p>
<p>You should now have an updated view of the core; notice the reduced file size displayed in the window title. To save as a .tiff, use File &gt; Save as &gt; Tiff&hellip;</p>
<h2 id="working-in-dragonfly">Working in Dragonfly<a hidden class="anchor" aria-hidden="true" href="#working-in-dragonfly">#</a></h2>
<h3 id="loading-and-masking">Loading &amp; masking<a hidden class="anchor" aria-hidden="true" href="#loading-and-masking">#</a></h3>
<p>In Dragonfly, open the newly created .tiff file with File &gt; Import Image Files&hellip; . Click the Add&hellip; button, then select the file. Click Next in the bottom right.</p>
<p>The fields on this screen should be correct. Ensure that the Total size (on right, under Information) is less than the amount of memory you have.</p>
<p>Click Crop Image&hellip; and preview the image of the soil core. If the core doesn&rsquo;t take up most of the frame, crop it by dragging the green dotted edges or corners inward.</p>
<p>In the Crop Image&hellip; window, crop the image to slices 250-1800. Under the Cropping slider, enter 250 in the first field and 1800 in the second. Click OK.</p>
<p>Click Finish. After loading, you should see four views of the core: a 3D render and three orthogonal views. You can maximize a pane by double clicking, and you can move the 3D view by clicking and dragging in its pane. Double click again to return to all four views.</p>
<p>Notice the &ldquo;fuzziness&rdquo; or garbage data visible in the 3D view (most visible looking top down, around the edges). To remove this data, we need to create a cylindrical mask.</p>
<p>At the top of the 3D view, there is a row of buttons under the Shapes bar. Click the cylinder button, the third from the left - note the capsule button right next to the cylinder button.</p>
<p>You should see a wireframe cylinder insdie of the soil core. Using one of the side orthogonal views, drag the green lines outward, and stop when you hit the garbage data.</p>
<p>You should see the cylinder on the other views increasing and get a sense of what you&rsquo;re doing. Everything outside the cylinder will be excluded.</p>
<p>On the right hand side of the screen, you should see a list of the objects loaded: the core and the cylinder. Click on the cylinder, and look under Shape properties, Visual effects, Visuals. Check the box next to the core. Check &ldquo;Outside&rdquo;, then under 3D effects, &ldquo;Clip&rdquo;. You should see the 3D view update to exclude anything outside the cylinder.</p>
<h3 id="animating">Animating<a hidden class="anchor" aria-hidden="true" href="#animating">#</a></h3>
<p>Right click the 3D view and select Show Movie Maker. Double click the 3D view pane to maximize it. You&rsquo;ll need to position the 3D view to be what you want the video to look like: I position the core straight on, with the camera slightly raised above it at an angle so the top is visible.</p>
<p>Click and drag to manipulate the core, and click and hold the middle mouse button and move your cursor up and down to zoom in and out. To physically move the core in the 3D space, press x on your keyboard and click and drag. Make sure to press escape when you are done moving it to return to the default track tool.</p>
<p>Once you&rsquo;ve positioned the core, look at the timeline near the bottom of the screen. At the 00:00 mark, you should see a square with a picture of the core in it. Right click it, and select &ldquo;Update key frame&rdquo;.</p>
<p>To actually rotate the core, click the &ldquo;Rotate&rdquo; button above the timeline. Choose one of the two right-most options (I use clockwise), and select &ldquo;Rotate around the object&rsquo;s axis&rdquo;. A second image, or keyframe, should appear on the timeline. Drag this second keyframe out to around the 20 second mark, or however long you want the video to be.</p>
<p>The original keyframe is where the animation will start, and the ending keyframe is exactly the same except that the core has been rotated 360 degrees. Dragonfly interpolates the motion in between the keyframes, so by dragging the 2nd keyframe further out along the timeline you are causing the core to spin slower.</p>
<p>You can drag the green bar marker along the timeline to preview the animation, or click the play symbol above the timeline. Note that the animation likely will not play at full speed, as it&rsquo;s rendering in real time.</p>
<p>To change the color of the background to a solid white, click the &ldquo;Scene&rsquo;s Views Properties&rdquo; bar in the left list of toolbars. Near-ish the top is a button next to &ldquo;Background color&rdquo;. In the window, you&rsquo;ll want to select &ldquo;Uniform&rdquo; under mode, and then click the button next to &ldquo;Color 1&rdquo; in the Color section on the right. In the color picker, drag the right mode slider up from black to white, and click OK, then OK. You should see the updated background.</p>
<p>To export the animation, click the &ldquo;Export animation&rdquo; symbol above the timeline, immediately next to the start / beginning symbol. Set the FPS to 60, the Dimensions preset to 1920x1080, and the bitrate to High. Click Save as Video File. Once you&rsquo;ve given a name and location for the file, Dragonfly will render and export the animation as an .avi file.</p>
<h2 id="working-with-dot-avi-video-files-dot">Working with .avi video files.<a hidden class="anchor" aria-hidden="true" href="#working-with-dot-avi-video-files-dot">#</a></h2>
<h2 id="ideas-maybe">Ideas maybe<a hidden class="anchor" aria-hidden="true" href="#ideas-maybe">#</a></h2>
<ul>
<li>Make little gif animations</li>
</ul>
<h2 id="gifs">GIFS:<a hidden class="anchor" aria-hidden="true" href="#gifs">#</a></h2>
<ul>
<li>GLOBUS transfer</li>
<li>fiji import dialogue</li>
<li>fiji converting to 8-bit</li>
<li>dragonfly import</li>
<li>dragonfly cropping</li>
<li>adjusting cylinder</li>
<li>outside, visual effects, clip</li>
<li>dragging keyframe</li>
<li>export animation from dragonfly</li>
<li></li>
</ul>
<!--listend-->
<ul>
<li>Screen recordings of dragonfly might be much easier to digest than explaining the ii over text</li>
<li></li>
</ul>
<h2 id="soil-cores">Soil cores<a hidden class="anchor" aria-hidden="true" href="#soil-cores">#</a></h2>
<ul>
<li>Cores from EMSL data portal
<ul>
<li>
<p>11, 15 AND 16, 20. Bottom if needed to choose</p>
<ul>
<li>
<p>15 bot: 3010819 top: 3010713</p>
</li>
<li>
<p>16 bot: 3011663 top: 3013268</p>
</li>
<li>
<p>11 bot: 3051409 top: 3051495</p>
</li>
<li>
<p>20 bot: 3010658 top: 3010660</p>
</li>
<li>
<p>1 bot: 3132984</p>
<ul>
<li>Had issues: use 2 bot: 3134562</li>
</ul>
</li>
<li>
<p>5 bot: 3135086</p>
</li>
<li>
<p>6 bot: 3135290</p>
<ul>
<li>Had issues that might make me use 7 bot: 3049610</li>
</ul>
</li>
<li>
<p>10 bot: 3133330</p>
<p>Made gifs for 11, 15, 16, 20.
Need to make gifs for: 2, 5, 7, 10</p>
</li>
</ul>
</li>
<li>
<p>11/8 update downloaded 2, 7. Now making gifs of those and finalizing gifs of others</p>
</li>
</ul>
</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 </span> · 

    <span>
        Love from Kansas · Created with Emacs
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
